{"version":3,"file":"AxisZoomCapture.js","names":["AxisZoomCapture","props","handleDragStartMouse","bind","handleDragStartTouch","handleDrag","handleDragEnd","handleRightClick","saveNode","state","startPosition","node","e","stopPropagation","preventDefault","onContextMenu","mouseXY","mousePosition","getBoundingClientRect","select","d3Window","on","MOUSEMOVE","MOUSEUP","setState","contextMenuClicked","mouseInteraction","getScale","getMoreProps","startScale","dragHappened","invert","startXY","touches","length","TOUCHMOVE","TOUCHEND","touchPosition","getTouchProps","getMouseDelta","inverted","isDefined","mouse","diff","center","mean","range","tempRange","map","d","sign","newDomain","last","first","axisZoomCallback","clicked","d3Event","onDoubleClick","setTimeout","bg","className","zoomCursorClassName","cursor","x","y","h","w","Component","propTypes","innerTickSize","PropTypes","number","outerTickSize","tickFormat","func","tickPadding","tickSize","ticks","tickValues","array","showDomain","bool","showTicks","string","object","isRequired","defaultProps","noop"],"sources":["../../../src/lib/axes/AxisZoomCapture.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { select, event as d3Event, mouse, touches } from \"d3-selection\";\r\nimport { mean } from \"d3-array\";\r\n\r\nimport {\r\n\tfirst,\r\n\tlast,\r\n\tisDefined,\r\n\tnoop,\r\n\tmousePosition,\r\n\td3Window,\r\n\tMOUSEMOVE,\r\n\tMOUSEUP,\r\n\tTOUCHMOVE,\r\n\tTOUCHEND,\r\n\ttouchPosition,\r\n\tgetTouchProps,\r\n\tsign,\r\n} from \"../utils\";\r\n\r\nclass AxisZoomCapture extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.handleDragStartMouse = this.handleDragStartMouse.bind(this);\r\n\t\tthis.handleDragStartTouch = this.handleDragStartTouch.bind(this);\r\n\t\tthis.handleDrag = this.handleDrag.bind(this);\r\n\t\tthis.handleDragEnd = this.handleDragEnd.bind(this);\r\n\t\tthis.handleRightClick = this.handleRightClick.bind(this);\r\n\t\tthis.saveNode = this.saveNode.bind(this);\r\n\t\tthis.state = {\r\n\t\t\tstartPosition: null\r\n\t\t};\r\n\t}\r\n\tsaveNode(node) {\r\n\t\tthis.node = node;\r\n\t}\r\n\thandleRightClick(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst { onContextMenu } = this.props;\r\n\r\n\t\tconst mouseXY = mousePosition(e, this.node.getBoundingClientRect());\r\n\r\n\t\tselect(d3Window(this.node))\r\n\t\t\t.on(MOUSEMOVE, null)\r\n\t\t\t.on(MOUSEUP, null);\r\n\t\tthis.setState({\r\n\t\t\tstartPosition: null,\r\n\t\t});\r\n\r\n\t\tonContextMenu(mouseXY, e);\r\n\r\n\t\tthis.contextMenuClicked = true;\r\n\t}\r\n\thandleDragStartMouse(e) {\r\n\t\tthis.mouseInteraction = true;\r\n\r\n\t\tconst { getScale, getMoreProps } = this.props;\r\n\t\tconst startScale = getScale(getMoreProps());\r\n\t\tthis.dragHappened = false;\r\n\r\n\t\tif (startScale.invert) {\r\n\t\t\tselect(d3Window(this.node))\r\n\t\t\t\t.on(MOUSEMOVE, this.handleDrag, false)\r\n\t\t\t\t.on(MOUSEUP, this.handleDragEnd, false);\r\n\r\n\t\t\tconst startXY = mousePosition(e);\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\tstartPosition: {\r\n\t\t\t\t\tstartXY,\r\n\t\t\t\t\tstartScale,\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t}\r\n\thandleDragStartTouch(e) {\r\n\t\tthis.mouseInteraction = false;\r\n\r\n\t\tconst { getScale, getMoreProps } = this.props;\r\n\t\tconst startScale = getScale(getMoreProps());\r\n\t\tthis.dragHappened = false;\r\n\r\n\t\tif (e.touches.length === 1 && startScale.invert) {\r\n\t\t\tselect(d3Window(this.node))\r\n\t\t\t\t.on(TOUCHMOVE, this.handleDrag)\r\n\t\t\t\t.on(TOUCHEND, this.handleDragEnd);\r\n\r\n\t\t\tconst startXY = touchPosition(getTouchProps(e.touches[0]), e);\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\tstartPosition: {\r\n\t\t\t\t\tstartXY,\r\n\t\t\t\t\tstartScale,\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleDrag() {\r\n\t\tconst { startPosition } = this.state;\r\n\t\tconst { getMouseDelta, inverted } = this.props;\r\n\r\n\t\tthis.dragHappened = true;\r\n\t\tif (isDefined(startPosition)) {\r\n\t\t\tconst { startScale } = startPosition;\r\n\t\t\tconst { startXY } = startPosition;\r\n\r\n\t\t\tconst mouseXY = this.mouseInteraction\r\n\t\t\t\t? mouse(this.node)\r\n\t\t\t\t: touches(this.node)[0];\r\n\r\n\t\t\tconst diff = getMouseDelta(startXY, mouseXY);\r\n\r\n\t\t\tconst center = mean(startScale.range());\r\n\r\n\t\t\tconst tempRange = startScale.range()\r\n\t\t\t\t.map(d => inverted ? d - sign(d - center) * diff : d + sign(d - center) * diff);\r\n\r\n\t\t\tconst newDomain = tempRange.map(startScale.invert);\r\n\r\n\t\t\tif (sign(last(startScale.range()) - first(startScale.range())) === sign(last(tempRange) - first(tempRange))) {\r\n\r\n\t\t\t\tconst { axisZoomCallback } = this.props;\r\n\t\t\t\t// console.log(startXScale.domain(), newXDomain)\r\n\t\t\t\taxisZoomCallback(newDomain);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\thandleDragEnd() {\r\n\r\n\t\tif (!this.dragHappened) {\r\n\t\t\tif (this.clicked) {\r\n\t\t\t\tconst e = d3Event;\r\n\t\t\t\tconst mouseXY = this.mouseInteraction\r\n\t\t\t\t\t? mouse(this.node)\r\n\t\t\t\t\t: touches(this.node)[0];\r\n\t\t\t\tconst { onDoubleClick } = this.props;\r\n\r\n\t\t\t\tonDoubleClick(mouseXY, e);\r\n\t\t\t} else {\r\n\t\t\t\tthis.clicked = true;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.clicked = false;\r\n\t\t\t\t}, 300);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tselect(d3Window(this.node))\r\n\t\t\t.on(MOUSEMOVE, null)\r\n\t\t\t.on(MOUSEUP, null)\r\n\t\t\t.on(TOUCHMOVE, null)\r\n\t\t\t.on(TOUCHEND, null);\r\n\r\n\t\tthis.setState({\r\n\t\t\tstartPosition: null,\r\n\t\t});\r\n\t}\r\n\trender() {\r\n\t\tconst { bg, className, zoomCursorClassName } = this.props;\r\n\r\n\t\tconst cursor = isDefined(this.state.startPosition)\r\n\t\t\t? zoomCursorClassName\r\n\t\t\t: \"react-stockcharts-default-cursor\";\r\n\r\n\t\treturn <rect\r\n\t\t\tclassName={`react-stockcharts-enable-interaction ${cursor} ${className}`}\r\n\t\t\tref={this.saveNode}\r\n\t\t\tx={bg.x} y={bg.y} opacity={0} height={bg.h} width={bg.w}\r\n\t\t\tonContextMenu={this.handleRightClick}\r\n\t\t\tonMouseDown={this.handleDragStartMouse}\r\n\t\t\tonTouchStart={this.handleDragStartTouch}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nAxisZoomCapture.propTypes = {\r\n\tinnerTickSize: PropTypes.number,\r\n\touterTickSize: PropTypes.number,\r\n\ttickFormat: PropTypes.func,\r\n\ttickPadding: PropTypes.number,\r\n\ttickSize: PropTypes.number,\r\n\tticks: PropTypes.number,\r\n\ttickValues: PropTypes.array,\r\n\tshowDomain: PropTypes.bool,\r\n\tshowTicks: PropTypes.bool,\r\n\tclassName: PropTypes.string,\r\n\taxisZoomCallback: PropTypes.func,\r\n\tinverted: PropTypes.bool,\r\n\tbg: PropTypes.object.isRequired,\r\n\tzoomCursorClassName: PropTypes.string.isRequired,\r\n\tgetMoreProps: PropTypes.func.isRequired,\r\n\tgetScale: PropTypes.func.isRequired,\r\n\tgetMouseDelta: PropTypes.func.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tonContextMenu: PropTypes.func.isRequired,\r\n};\r\n\r\nAxisZoomCapture.defaultProps = {\r\n\tonDoubleClick: noop,\r\n\tonContextMenu: noop,\r\n\tinverted: true\r\n};\r\n\r\nexport default AxisZoomCapture;\r\n"],"mappings":"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"}