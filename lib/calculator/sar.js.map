{"version":3,"file":"sar.js","names":["calc","prev","now","risingSar","af","risingEp","fallingSar","fallingEp","Math","max","high","min","low","options","defaultOptions","calculator","data","accelerationFactor","maxAccelerationFactor","algorithm","mappedSlidingWindow","windowSize","undefinedValue","accumulator","isNotDefined","use","isDefined","current","date","sar","calculatedData","map","d","undefinedLength","x","arguments","length"],"sources":["../../../src/lib/calculator/sar.js"],"sourcesContent":["\r\n\r\nimport { mappedSlidingWindow, isNotDefined, isDefined } from \"../utils\";\r\nimport { SAR as defaultOptions } from \"./defaultOptionsForComputation\";\r\n\r\nfunction calc(prev, now) {\r\n\tconst risingSar = prev.risingSar\r\n\t\t+ prev.af * (prev.risingEp - prev.risingSar);\r\n\r\n\tconst fallingSar = prev.fallingSar\r\n\t\t- prev.af * (prev.fallingSar - prev.fallingEp);\r\n\r\n\tconst risingEp = Math.max(prev.risingEp, now.high);\r\n\tconst fallingEp = Math.min(prev.fallingEp, now.low);\r\n\r\n\treturn {\r\n\t\trisingSar,\r\n\t\tfallingSar,\r\n\t\trisingEp,\r\n\t\tfallingEp,\r\n\t};\r\n}\r\n\r\nexport default function() {\r\n\r\n\tlet options = defaultOptions;\r\n\r\n\tfunction calculator(data) {\r\n\t\tconst { accelerationFactor, maxAccelerationFactor } = options;\r\n\r\n\t\tconst algorithm = mappedSlidingWindow()\r\n\t\t\t.windowSize(2)\r\n\t\t\t.undefinedValue(({ high, low }) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\trisingSar: low,\r\n\t\t\t\t\trisingEp: high,\r\n\t\t\t\t\tfallingSar: high,\r\n\t\t\t\t\tfallingEp: low,\r\n\t\t\t\t\taf: accelerationFactor,\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.accumulator(([prev, now]) => {\r\n\r\n\t\t\t\tconst {\r\n\t\t\t\t\trisingSar,\r\n\t\t\t\t\tfallingSar,\r\n\t\t\t\t\trisingEp,\r\n\t\t\t\t\tfallingEp,\r\n\t\t\t\t} = calc(prev, now);\r\n\r\n\t\t\t\tif (isNotDefined(prev.use)\r\n\t\t\t\t\t\t&& risingSar > now.low\r\n\t\t\t\t\t\t&& fallingSar < now.high) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\trisingSar,\r\n\t\t\t\t\t\tfallingSar,\r\n\t\t\t\t\t\trisingEp,\r\n\t\t\t\t\t\tfallingEp,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst use = isDefined(prev.use)\r\n\t\t\t\t\t? prev.use === \"rising\"\r\n\t\t\t\t\t\t? risingSar > now.low ? \"falling\" : \"rising\"\r\n\t\t\t\t\t\t: fallingSar < now.high ? \"rising\" : \"falling\"\r\n\t\t\t\t\t: risingSar > now.low\r\n\t\t\t\t\t\t? \"falling\"\r\n\t\t\t\t\t\t: \"rising\";\r\n\r\n\t\t\t\tconst current = prev.use === use\r\n\t\t\t\t\t? {\r\n\t\t\t\t\t\taf: Math.min(maxAccelerationFactor, prev.af + accelerationFactor),\r\n\t\t\t\t\t\tfallingEp,\r\n\t\t\t\t\t\trisingEp,\r\n\t\t\t\t\t\tfallingSar,\r\n\t\t\t\t\t\trisingSar,\r\n\t\t\t\t\t}\r\n\t\t\t\t\t: {\r\n\t\t\t\t\t\taf: accelerationFactor,\r\n\t\t\t\t\t\tfallingEp: now.low,\r\n\t\t\t\t\t\trisingEp: now.high,\r\n\t\t\t\t\t\tfallingSar: Math.max(prev.risingEp, now.high),\r\n\t\t\t\t\t\trisingSar: Math.min(prev.fallingEp, now.low),\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\tconst { date, high, low } = now;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdate,\r\n\t\t\t\t\thigh,\r\n\t\t\t\t\tlow,\r\n\t\t\t\t\t...current,\r\n\t\t\t\t\tuse,\r\n\t\t\t\t\tsar: use === \"falling\" ? current.fallingSar : current.risingSar,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\tconst calculatedData = algorithm(data).map(d => d.sar);\r\n\t\t// console.log(calculatedData);\r\n\r\n\t\treturn calculatedData;\r\n\t}\r\n\tcalculator.undefinedLength = function() {\r\n\t\treturn 1;\r\n\t};\r\n\tcalculator.options = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\toptions = { ...defaultOptions, ...x };\r\n\t\treturn calculator;\r\n\t};\r\n\r\n\treturn calculator;\r\n}\r\n"],"mappings":"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"}