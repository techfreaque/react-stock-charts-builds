{"version":3,"file":"pointAndFigure.js","names":["createBox","d","dateAccessor","dateMutator","box","open","fromDate","toDate","startOfYear","startOfQuarter","startOfMonth","startOfWeek","updateColumns","columnData","forEach","boxes","eachBox","isNotDefined","close","high","Math","max","low","min","date","options","defaultOptions","calculator","rawData","reversal","boxSize","sourcePath","source","pricingMethod","column","push","volume","length","upwardMovement","downwardMovement","abs","direction","noOfBoxes","floor","i","prevBoxClose","x","arguments"],"sources":["../../../src/lib/calculator/pointAndFigure.js"],"sourcesContent":["\r\n\r\nimport { isNotDefined } from \"../utils\";\r\nimport { PointAndFigure as defaultOptions } from \"./defaultOptionsForComputation\";\r\n\r\nfunction createBox(d, dateAccessor, dateMutator) {\r\n\tconst box = {\r\n\t\topen: d.open,\r\n\t\tfromDate: dateAccessor(d),\r\n\t\ttoDate: dateAccessor(d),\r\n\t\tstartOfYear: d.startOfYear,\r\n\t\tstartOfQuarter: d.startOfQuarter,\r\n\t\tstartOfMonth: d.startOfMonth,\r\n\t\tstartOfWeek: d.startOfWeek\r\n\t};\r\n\tdateMutator(box, dateAccessor(d));\r\n\treturn box;\r\n}\r\n\r\nfunction updateColumns(columnData, dateAccessor, dateMutator) {\r\n\tcolumnData.forEach(function(d) {\r\n\t\t// var lastBox = d.boxes[d.boxes.length - 1];\r\n\r\n\t\td.startOfYear = false;\r\n\t\td.startOfQuarter = false;\r\n\t\td.startOfMonth = false;\r\n\t\td.startOfWeek = false;\r\n\r\n\t\td.boxes.forEach(function(eachBox) {\r\n\t\t\tif (isNotDefined(d.open)) d.open = eachBox.open;\r\n\t\t\td.close = eachBox.close;\r\n\t\t\td.high = Math.max(d.open, d.close);\r\n\t\t\td.low = Math.min(d.open, d.close);\r\n\r\n\t\t\tif (isNotDefined(d.fromDate)) d.fromDate = eachBox.fromDate;\r\n\t\t\tif (isNotDefined(d.date)) d.date = eachBox.date;\r\n\t\t\td.toDate = eachBox.toDate;\r\n\r\n\t\t\tif (eachBox.startOfYear) {\r\n\t\t\t\td.startOfYear = d.startOfYear || eachBox.startOfYear;\r\n\t\t\t\td.startOfQuarter = eachBox.startOfQuarter;\r\n\t\t\t\td.startOfMonth = eachBox.startOfMonth;\r\n\t\t\t\td.startOfWeek = eachBox.startOfWeek;\r\n\r\n\t\t\t\tdateMutator(d, dateAccessor(eachBox));\r\n\t\t\t}\r\n\t\t\tif (d.startOfQuarter !== true && eachBox.startOfQuarter) {\r\n\t\t\t\td.startOfQuarter = eachBox.startOfQuarter;\r\n\t\t\t\td.startOfMonth = eachBox.startOfMonth;\r\n\t\t\t\td.startOfWeek = eachBox.startOfWeek;\r\n\t\t\t\t// d.displayDate = eachBox.displayDate;\r\n\t\t\t\tdateMutator(d, dateAccessor(eachBox));\r\n\t\t\t}\r\n\t\t\tif (d.startOfMonth !== true && eachBox.startOfMonth) {\r\n\t\t\t\td.startOfMonth = eachBox.startOfMonth;\r\n\t\t\t\td.startOfWeek = eachBox.startOfWeek;\r\n\t\t\t\t// d.displayDate = eachBox.displayDate;\r\n\t\t\t\tdateMutator(d, dateAccessor(eachBox));\r\n\t\t\t}\r\n\t\t\tif (d.startOfWeek !== true && eachBox.startOfWeek) {\r\n\t\t\t\td.startOfWeek = eachBox.startOfWeek;\r\n\t\t\t\t// d.displayDate = eachBox.displayDate;\r\n\t\t\t\tdateMutator(d, dateAccessor(eachBox));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t// console.table(columnData);\r\n\t// console.table(rawData);\r\n\treturn columnData;\r\n}\r\n\r\n\r\nexport default function() {\r\n\tlet options = defaultOptions;\r\n\tlet dateAccessor = d => d.date;\r\n\tlet dateMutator = (d, date) => { d.date = date; };\r\n\r\n\tfunction calculator(rawData) {\r\n\t\tconst { reversal, boxSize, sourcePath } = options;\r\n\r\n\t\tconst source = sourcePath === \"high/low\"\r\n\t\t\t? d => { return { high: d.high, low: d.low }; }\r\n\t\t\t: d => { return { high: d.close, low: d.close }; };\r\n\r\n\r\n\t\tconst pricingMethod = source;\r\n\t\tconst columnData = [];\r\n\r\n\t\tlet column = {\r\n\t\t\t\tboxes: [],\r\n\t\t\t\topen: rawData[0].open\r\n\t\t\t}, box = createBox(rawData[0], dateAccessor, dateMutator);\r\n\r\n\t\tcolumnData.push(column);\r\n\r\n\t\trawData.forEach(function(d) {\r\n\t\t\tcolumn.volume = (column.volume || 0) + d.volume;\r\n\r\n\t\t\tif (!box.startOfYear) {\r\n\t\t\t\tbox.startOfYear = d.startOfYear;\r\n\t\t\t\tif (box.startOfYear) {\r\n\t\t\t\t\tdateMutator(box, dateAccessor(d));\r\n\t\t\t\t\t// box.displayDate = d.displayDate;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!box.startOfYear && !box.startOfQuarter) {\r\n\t\t\t\tbox.startOfQuarter = d.startOfQuarter;\r\n\t\t\t\tif (box.startOfQuarter && !box.startOfYear) {\r\n\t\t\t\t\tdateMutator(box, dateAccessor(d));\r\n\t\t\t\t\t// box.displayDate = d.displayDate;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!box.startOfQuarter && !box.startOfMonth) {\r\n\t\t\t\tbox.startOfMonth = d.startOfMonth;\r\n\t\t\t\tif (box.startOfMonth && !box.startOfQuarter) {\r\n\t\t\t\t\tdateMutator(box, dateAccessor(d));\r\n\t\t\t\t\t// box.displayDate = d.displayDate;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!box.startOfMonth && !box.startOfWeek) {\r\n\t\t\t\tbox.startOfWeek = d.startOfWeek;\r\n\t\t\t\tif (box.startOfWeek && !box.startOfMonth) {\r\n\t\t\t\t\tdateMutator(box, dateAccessor(d));\r\n\t\t\t\t\t// box.displayDate = d.displayDate;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (columnData.length === 1 && column.boxes.length === 0) {\r\n\t\t\t\tconst upwardMovement = (Math.max((pricingMethod(d).high - column.open), 0)); // upward movement\r\n\t\t\t\tconst downwardMovement = Math.abs(Math.min((column.open - pricingMethod(d).low), 0)); // downward movement\r\n\t\t\t\tcolumn.direction = upwardMovement > downwardMovement ? 1 : -1;\r\n\t\t\t\tif (boxSize * reversal < upwardMovement\r\n\t\t\t\t\t|| boxSize * reversal < downwardMovement) {\r\n\t\t\t\t\t// enough movement to trigger a reversal\r\n\t\t\t\t\tbox.toDate = dateAccessor(d);\r\n\t\t\t\t\tbox.open = column.open;\r\n\t\t\t\t\tconst noOfBoxes = column.direction > 0\r\n\t\t\t\t\t\t? Math.floor(upwardMovement / boxSize)\r\n\t\t\t\t\t\t: Math.floor(downwardMovement / boxSize);\r\n\t\t\t\t\tfor (let i = 0; i < noOfBoxes; i++) {\r\n\t\t\t\t\t\tbox.close = box.open + column.direction * boxSize;\r\n\t\t\t\t\t\tconst prevBoxClose = box.close;\r\n\t\t\t\t\t\tcolumn.boxes.push(box);\r\n\t\t\t\t\t\tbox = createBox(box, dateAccessor, dateMutator);\r\n\t\t\t\t\t\t// box = cloneMe(box);\r\n\t\t\t\t\t\tbox.open = prevBoxClose;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbox.fromDate = dateAccessor(d);\r\n\t\t\t\t\tbox.date = dateAccessor(d);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// one or more boxes already formed in the current column\r\n\t\t\t\tconst upwardMovement = (Math.max((pricingMethod(d).high - box.open), 0)); // upward movement\r\n\t\t\t\tconst downwardMovement = Math.abs(Math.min((pricingMethod(d).low - box.open), 0)); // downward movement\r\n\r\n\t\t\t\tif ((column.direction > 0 && upwardMovement > boxSize) /* rising column AND box can be formed */\r\n\t\t\t\t\t\t|| (column.direction < 0 && downwardMovement > boxSize) /* falling column AND box can be formed */ ) {\r\n\t\t\t\t\t// form another box\r\n\t\t\t\t\tbox.close = box.open + column.direction * boxSize;\r\n\t\t\t\t\tbox.toDate = dateAccessor(d);\r\n\t\t\t\t\tconst prevBoxClose = box.close;\r\n\t\t\t\t\tcolumn.boxes.push(box);\r\n\t\t\t\t\tbox = createBox(d, dateAccessor, dateMutator);\r\n\t\t\t\t\tbox.open = prevBoxClose;\r\n\t\t\t\t\tbox.fromDate = dateAccessor(d);\r\n\t\t\t\t\tdateMutator(box, dateAccessor(d));\r\n\t\t\t\t} else if ((column.direction > 0 && downwardMovement > boxSize * reversal) /* rising column and there is downward movement to trigger a reversal */\r\n\t\t\t\t\t\t|| (column.direction < 0 && upwardMovement > boxSize * reversal)/* falling column and there is downward movement to trigger a reversal */) {\r\n\t\t\t\t\t// reversal\r\n\r\n\t\t\t\t\tbox.open = box.open + -1 * column.direction * boxSize;\r\n\t\t\t\t\tbox.toDate = dateAccessor(d);\r\n\t\t\t\t\t// box.displayDate = d.displayDate;\r\n\t\t\t\t\tdateMutator(box, dateAccessor(d));\r\n\t\t\t\t\t// box.startOfYear = d.startOfYear;\r\n\t\t\t\t\t// box.startOfQuarter = d.startOfQuarter;\r\n\t\t\t\t\t// box.startOfMonth = d.startOfMonth;\r\n\t\t\t\t\t// box.startOfWeek = d.startOfWeek;\r\n\t\t\t\t\t// console.table(column.boxes);\r\n\t\t\t\t\t// var idx = index + 1;\r\n\t\t\t\t\tcolumn = {\r\n\t\t\t\t\t\tboxes: [],\r\n\t\t\t\t\t\tvolume: 0,\r\n\t\t\t\t\t\tdirection: -1 * column.direction\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconst noOfBoxes = column.direction > 0\r\n\t\t\t\t\t\t? Math.floor(upwardMovement / boxSize)\r\n\t\t\t\t\t\t: Math.floor(downwardMovement / boxSize);\r\n\t\t\t\t\tfor (let i = 0; i < noOfBoxes; i++) {\r\n\t\t\t\t\t\tbox.close = box.open + column.direction * boxSize;\r\n\t\t\t\t\t\tconst prevBoxClose = box.close;\r\n\t\t\t\t\t\tcolumn.boxes.push(box);\r\n\t\t\t\t\t\tbox = createBox(d, dateAccessor, dateMutator);\r\n\t\t\t\t\t\tbox.open = prevBoxClose;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcolumnData.push(column);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tupdateColumns(columnData, dateAccessor, dateMutator);\r\n\r\n\t\treturn columnData;\r\n\t}\r\n\tcalculator.options = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\toptions = { ...defaultOptions, ...x };\r\n\t\treturn calculator;\r\n\t};\r\n\tcalculator.dateMutator = function(x) {\r\n\t\tif (!arguments.length) return dateMutator;\r\n\t\tdateMutator = x;\r\n\t\treturn calculator;\r\n\t};\r\n\tcalculator.dateAccessor = function(x) {\r\n\t\tif (!arguments.length) return dateAccessor;\r\n\t\tdateAccessor = x;\r\n\t\treturn calculator;\r\n\t};\r\n\r\n\treturn calculator;\r\n}\r\n"],"mappings":"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"}