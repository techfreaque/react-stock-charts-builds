{"version":3,"file":"atr.js","names":["options","defaultOptions","source","d","open","high","low","close","calculator","data","windowSize","trueRangeAlgorithm","slidingWindow","undefinedValue","accumulator","values","prev","Math","max","prevATR","atrAlgorithm","skipInitial","tr","last","atr","isDefined","sum","newData","undefinedLength","x","arguments","length"],"sources":["../../../src/lib/calculator/atr.js"],"sourcesContent":["\r\n\r\nimport { sum } from \"d3-array\";\r\n\r\nimport { ATR as defaultOptions } from \"./defaultOptionsForComputation\";\r\nimport { slidingWindow, last, isDefined } from \"../utils\";\r\n\r\nexport default function() {\r\n\r\n\tlet options = defaultOptions;\r\n\tlet source = d => ({ open: d.open, high: d.high, low: d.low, close: d.close });\r\n\r\n\tfunction calculator(data) {\r\n\t\tconst { windowSize } = options;\r\n\r\n\t\tconst trueRangeAlgorithm = slidingWindow()\r\n\t\t\t.windowSize(2)\r\n\t\t\t.source(source)\r\n\t\t\t.undefinedValue(d => d.high - d.low) // the first TR value is simply the High minus the Low\r\n\t\t\t.accumulator(values => {\r\n\t\t\t\tconst prev = values[0];\r\n\t\t\t\tconst d = values[1];\r\n\t\t\t\treturn Math.max(d.high - d.low,\r\n\t\t\t\t\td.high - prev.close,\r\n\t\t\t\t\td.low - prev.close);\r\n\t\t\t});\r\n\r\n\t\tlet prevATR;\r\n\r\n\t\tconst atrAlgorithm = slidingWindow()\r\n\t\t\t.skipInitial(1) // trueRange starts from index 1 so ATR starts from 1\r\n\t\t\t.windowSize(windowSize)\r\n\t\t\t.accumulator(values => {\r\n\t\t\t\tconst tr = last(values);\r\n\t\t\t\tconst atr = isDefined(prevATR)\r\n\t\t\t\t\t? ((prevATR * (windowSize - 1)) + tr) / windowSize\r\n\t\t\t\t\t: sum(values) / windowSize;\r\n\r\n\t\t\t\tprevATR = atr;\r\n\t\t\t\treturn atr;\r\n\t\t\t});\r\n\r\n\t\tconst newData = atrAlgorithm(trueRangeAlgorithm(data));\r\n\r\n\t\treturn newData;\r\n\t}\r\n\tcalculator.undefinedLength = function() {\r\n\t\tconst { windowSize } = options;\r\n\t\treturn windowSize - 1;\r\n\t};\r\n\tcalculator.options = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\toptions = { ...defaultOptions, ...x };\r\n\t\treturn calculator;\r\n\t};\r\n\r\n\tcalculator.source = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn source;\r\n\t\t}\r\n\t\tsource = x;\r\n\t\treturn calculator;\r\n\t};\r\n\r\n\treturn calculator;\r\n}\r\n"],"mappings":";;;;;;;AAEA;;AAEA;;AACA;;;;;;;;AAEe,oBAAW;EAEzB,IAAIA,OAAO,GAAGC,iCAAd;;EACA,IAAIC,MAAM,GAAG,gBAAAC,CAAC;IAAA,OAAK;MAAEC,IAAI,EAAED,CAAC,CAACC,IAAV;MAAgBC,IAAI,EAAEF,CAAC,CAACE,IAAxB;MAA8BC,GAAG,EAAEH,CAAC,CAACG,GAArC;MAA0CC,KAAK,EAAEJ,CAAC,CAACI;IAAnD,CAAL;EAAA,CAAd;;EAEA,SAASC,UAAT,CAAoBC,IAApB,EAA0B;IACzB,eAAuBT,OAAvB;IAAA,IAAQU,UAAR,YAAQA,UAAR;IAEA,IAAMC,kBAAkB,GAAG,IAAAC,oBAAA,IACzBF,UADyB,CACd,CADc,EAEzBR,MAFyB,CAElBA,MAFkB,EAGzBW,cAHyB,CAGV,UAAAV,CAAC;MAAA,OAAIA,CAAC,CAACE,IAAF,GAASF,CAAC,CAACG,GAAf;IAAA,CAHS,EAGW;IAHX,CAIzBQ,WAJyB,CAIb,UAAAC,MAAM,EAAI;MACtB,IAAMC,IAAI,GAAGD,MAAM,CAAC,CAAD,CAAnB;MACA,IAAMZ,CAAC,GAAGY,MAAM,CAAC,CAAD,CAAhB;MACA,OAAOE,IAAI,CAACC,GAAL,CAASf,CAAC,CAACE,IAAF,GAASF,CAAC,CAACG,GAApB,EACNH,CAAC,CAACE,IAAF,GAASW,IAAI,CAACT,KADR,EAENJ,CAAC,CAACG,GAAF,GAAQU,IAAI,CAACT,KAFP,CAAP;IAGA,CAVyB,CAA3B;IAYA,IAAIY,OAAJ;IAEA,IAAMC,YAAY,GAAG,IAAAR,oBAAA,IACnBS,WADmB,CACP,CADO,EACJ;IADI,CAEnBX,UAFmB,CAERA,UAFQ,EAGnBI,WAHmB,CAGP,UAAAC,MAAM,EAAI;MACtB,IAAMO,EAAE,GAAG,IAAAC,WAAA,EAAKR,MAAL,CAAX;MACA,IAAMS,GAAG,GAAG,IAAAC,gBAAA,EAAUN,OAAV,IACT,CAAEA,OAAO,IAAIT,UAAU,GAAG,CAAjB,CAAR,GAA+BY,EAAhC,IAAsCZ,UAD7B,GAET,IAAAgB,YAAA,EAAIX,MAAJ,IAAcL,UAFjB;MAIAS,OAAO,GAAGK,GAAV;MACA,OAAOA,GAAP;IACA,CAXmB,CAArB;IAaA,IAAMG,OAAO,GAAGP,YAAY,CAACT,kBAAkB,CAACF,IAAD,CAAnB,CAA5B;IAEA,OAAOkB,OAAP;EACA;;EACDnB,UAAU,CAACoB,eAAX,GAA6B,YAAW;IACvC,gBAAuB5B,OAAvB;IAAA,IAAQU,UAAR,aAAQA,UAAR;IACA,OAAOA,UAAU,GAAG,CAApB;EACA,CAHD;;EAIAF,UAAU,CAACR,OAAX,GAAqB,UAAS6B,CAAT,EAAY;IAChC,IAAI,CAACC,SAAS,CAACC,MAAf,EAAuB;MACtB,OAAO/B,OAAP;IACA;;IACDA,OAAO,mCAAQC,iCAAR,GAA2B4B,CAA3B,CAAP;IACA,OAAOrB,UAAP;EACA,CAND;;EAQAA,UAAU,CAACN,MAAX,GAAoB,UAAS2B,CAAT,EAAY;IAC/B,IAAI,CAACC,SAAS,CAACC,MAAf,EAAuB;MACtB,OAAO7B,MAAP;IACA;;IACDA,MAAM,GAAG2B,CAAT;IACA,OAAOrB,UAAP;EACA,CAND;;EAQA,OAAOA,UAAP;AACA"}