{"version":3,"file":"discontinuousTimeScaleProvider.js","names":["evaluateLevel","d","date","i","formatters","levelDefinition","map","eachLevel","idx","level","length","format","find","l","discontinuousIndexCalculator","slidingWindow","windowSize","undefinedValue","initialIndex","row","getTime","startOf30Seconds","startOfMinute","startOf5Minutes","startOf15Minutes","startOf30Minutes","startOfHour","startOfEighthOfADay","startOfQuarterDay","startOfHalfDay","startOfDay","startOfWeek","startOfMonth","startOfQuarter","startOfYear","index","discontinuousIndexCalculatorLocalTime","accumulator","prevDate","nowDate","getSeconds","getMinutes","getHours","getDay","getMonth","getFullYear","console","log","doStuff","realDateAccessor","inputDateAccessor","data","dateAccessor","calculate","source","misc","each","Date","timeFormat","discontinuousTimeScaleProviderBuilder","identity","indexAccessor","indexMutator","withIndex","currentFormatters","defaultFormatters","discontinuousTimeScaleProvider","isNotDefined","response","inputIndex","xScale","financeDiscontinuousScale","mergedData","zipper","combine","finalData","xAccessor","displayXAccessor","x","arguments","utc","offsetInMillis","getTimezoneOffset","setLocale","locale","timeFormatDefaultLocale","indexCalculator"],"sources":["../../../src/lib/scale/discontinuousTimeScaleProvider.js"],"sourcesContent":["\r\n\r\nimport { timeFormat, timeFormatDefaultLocale } from \"d3-time-format\";\r\n// import { map as d3Map } from \"d3-collection\";\r\n\r\nimport financeDiscontinuousScale from \"./financeDiscontinuousScale\";\r\nimport { slidingWindow, zipper, identity, isNotDefined } from \"../utils\";\r\nimport { defaultFormatters, levelDefinition } from \"./levels\";\r\n\r\nfunction evaluateLevel(d, date, i, formatters) {\r\n\treturn levelDefinition\r\n\t\t.map((eachLevel, idx) => {\r\n\t\t\treturn {\r\n\t\t\t\tlevel: levelDefinition.length - idx - 1,\r\n\t\t\t\tformat: formatters[eachLevel(d, date, i)]\r\n\t\t\t};\r\n\t\t})\r\n\t\t.find(l => !!l.format);\r\n}\r\n\r\nconst discontinuousIndexCalculator = slidingWindow()\r\n\t.windowSize(2)\r\n\t.undefinedValue((d, idx, { initialIndex, formatters }) => {\r\n\t\tconst i = initialIndex;\r\n\t\tconst row = {\r\n\t\t\tdate: d.getTime(),\r\n\t\t\tstartOf30Seconds: false,\r\n\t\t\tstartOfMinute: false,\r\n\t\t\tstartOf5Minutes: false,\r\n\t\t\tstartOf15Minutes: false,\r\n\t\t\tstartOf30Minutes: false,\r\n\t\t\tstartOfHour: false,\r\n\t\t\tstartOfEighthOfADay: false,\r\n\t\t\tstartOfQuarterDay: false,\r\n\t\t\tstartOfHalfDay: false,\r\n\t\t\tstartOfDay: true,\r\n\t\t\tstartOfWeek: false,\r\n\t\t\tstartOfMonth: false,\r\n\t\t\tstartOfQuarter: false,\r\n\t\t\tstartOfYear: false,\r\n\t\t};\r\n\t\tconst level = evaluateLevel(row, d, i, formatters);\r\n\t\treturn { ...row, index: i, ...level };\r\n\t});\r\n\r\nconst discontinuousIndexCalculatorLocalTime = discontinuousIndexCalculator\r\n\t.accumulator(([prevDate, nowDate], i, idx, { initialIndex, formatters }) => {\r\n\t\tconst startOf30Seconds = nowDate.getSeconds() % 30 === 0;\r\n\r\n\t\tconst startOfMinute = nowDate.getMinutes() !== prevDate.getMinutes();\r\n\t\tconst startOf5Minutes = startOfMinute && nowDate.getMinutes() % 5 <= prevDate.getMinutes() % 5;\r\n\t\tconst startOf15Minutes = startOfMinute && nowDate.getMinutes() % 15 <= prevDate.getMinutes() % 15;\r\n\t\tconst startOf30Minutes = startOfMinute && nowDate.getMinutes() % 30 <= prevDate.getMinutes() % 30;\r\n\r\n\t\tconst startOfHour = nowDate.getHours() !== prevDate.getHours();\r\n\r\n\t\tconst startOfEighthOfADay = startOfHour && nowDate.getHours() % 3 === 0;\r\n\t\tconst startOfQuarterDay = startOfHour && nowDate.getHours() % 6 === 0;\r\n\t\tconst startOfHalfDay = startOfHour && nowDate.getHours() % 12 === 0;\r\n\r\n\t\tconst startOfDay = nowDate.getDay() !== prevDate.getDay();\r\n\t\t// According to ISO calendar\r\n\t\t// Sunday = 0, Monday = 1, ... Saturday = 6\r\n\t\t// day of week of today < day of week of yesterday then today is start of week\r\n\t\tconst startOfWeek = nowDate.getDay() < prevDate.getDay();\r\n\t\t// month of today != month of yesterday then today is start of month\r\n\t\tconst startOfMonth = nowDate.getMonth() !== prevDate.getMonth();\r\n\t\t// if start of month and month % 3 === 0 then it is start of quarter\r\n\t\tconst startOfQuarter = startOfMonth && (nowDate.getMonth() % 3 <= prevDate.getMonth() % 3);\r\n\t\t// year of today != year of yesterday then today is start of year\r\n\t\tconst startOfYear = nowDate.getFullYear() !== prevDate.getFullYear();\r\n\r\n\t\tconst row = {\r\n\t\t\tdate: nowDate.getTime(),\r\n\t\t\tstartOf30Seconds,\r\n\t\t\tstartOfMinute,\r\n\t\t\tstartOf5Minutes,\r\n\t\t\tstartOf15Minutes,\r\n\t\t\tstartOf30Minutes,\r\n\t\t\tstartOfHour,\r\n\t\t\tstartOfEighthOfADay,\r\n\t\t\tstartOfQuarterDay,\r\n\t\t\tstartOfHalfDay,\r\n\t\t\tstartOfDay,\r\n\t\t\tstartOfWeek,\r\n\t\t\tstartOfMonth,\r\n\t\t\tstartOfQuarter,\r\n\t\t\tstartOfYear,\r\n\t\t};\r\n\t\tconst level = evaluateLevel(row, nowDate, i, formatters);\r\n\t\tif (level == null) {\r\n\t\t\tconsole.log(row);\r\n\t\t}\r\n\t\treturn { ...row, index: i + initialIndex, ...level };\r\n\t});\r\n\r\nfunction doStuff(realDateAccessor, inputDateAccessor, initialIndex, formatters) {\r\n\treturn function(data) {\r\n\t\tconst dateAccessor = realDateAccessor(inputDateAccessor);\r\n\t\tconst calculate = discontinuousIndexCalculatorLocalTime\r\n\t\t\t.source(dateAccessor)\r\n\t\t\t.misc({ initialIndex, formatters });\r\n\r\n\t\tconst index = calculate(data).map(each => {\r\n\t\t\tconst { format } = each;\r\n\t\t\treturn {\r\n\t\t\t\t// ...each,\r\n\t\t\t\tindex: each.index,\r\n\t\t\t\tlevel: each.level,\r\n\t\t\t\tdate: new Date(each.date),\r\n\t\t\t\tformat: timeFormat(format),\r\n\t\t\t};\r\n\t\t});\r\n\t\t/*\r\n\t\tvar map = d3Map();\r\n\t\tfor (var i = 0; i < data.length - 1; i++) {\r\n\r\n\t\t\tvar nextDate = dateAccessor(data[i + 1]);\r\n\t\t\tvar nowDate = dateAccessor(data[i]);\r\n\t\t\tvar diff = nextDate - nowDate;\r\n\r\n\t\t\tif (map.has(diff)) {\r\n\t\t\t\tvar count = parseInt(map.get(diff), 10) + 1;\r\n\t\t\t\tmap.set(diff, count);\r\n\t\t\t} else {\r\n\t\t\t\tmap.set(diff, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar entries = map.entries().sort((a, b) => a.value < b.value);\r\n\r\n\t\t// For Renko/p&f\r\n\r\n\t\tvar interval = entries[0].value === 1\r\n\t\t\t? Math.round((dateAccessor(last(data)) - dateAccessor(head(data))) / data.length)\r\n\t\t\t: parseInt(entries[0].key, 10); */\r\n\r\n\t\t// return { index, interval };\r\n\t\treturn { index };\r\n\t};\r\n}\r\n\r\nexport function discontinuousTimeScaleProviderBuilder() {\r\n\tlet initialIndex = 0, realDateAccessor = identity;\r\n\tlet inputDateAccessor = d => d.date,\r\n\t\tindexAccessor = d => d.idx,\r\n\t\tindexMutator = (d, idx) => ({ ...d, idx }),\r\n\t\twithIndex;\r\n\r\n\tlet currentFormatters = defaultFormatters;\r\n\r\n\t// eslint-disable-next-line prefer-const\r\n\tlet discontinuousTimeScaleProvider = function(data) {\r\n\t\t/*\r\n\t\tconsole.warn(\"Are you sure you want to use a discontinuousTimeScale?\"\r\n\t\t\t+ \" Use this only if you have discontinuous data which\"\r\n\t\t\t+ \" needs to be displayed as continuous.\"\r\n\t\t\t+ \" If you have continuous data use a d3 scale like\"\r\n\t\t\t+ \" `d3.scaleTime`\"\r\n\t\t);\r\n\t\t*/\r\n\r\n\t\tlet index = withIndex;\r\n\r\n\t\tif (isNotDefined(index)) {\r\n\t\t\tconst response = doStuff(\r\n\t\t\t\trealDateAccessor,\r\n\t\t\t\tinputDateAccessor,\r\n\t\t\t\tinitialIndex,\r\n\t\t\t\tcurrentFormatters\r\n\t\t\t)(data);\r\n\r\n\t\t\tindex = response.index;\r\n\t\t}\r\n\t\t// console.log(interval, entries[0].key);\r\n\r\n\t\tconst inputIndex = index;\r\n\t\tconst xScale = financeDiscontinuousScale(\r\n\t\t\tinputIndex,\r\n\t\t);\r\n\r\n\t\tconst mergedData = zipper()\r\n\t\t\t.combine(indexMutator);\r\n\r\n\t\tconst finalData = mergedData(data, inputIndex);\r\n\r\n\t\treturn {\r\n\t\t\tdata: finalData,\r\n\t\t\txScale,\r\n\t\t\txAccessor: d => d && indexAccessor(d).index,\r\n\t\t\tdisplayXAccessor: realDateAccessor(inputDateAccessor),\r\n\t\t};\r\n\t};\r\n\r\n\tdiscontinuousTimeScaleProvider.initialIndex = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn initialIndex;\r\n\t\t}\r\n\t\tinitialIndex = x;\r\n\t\treturn discontinuousTimeScaleProvider;\r\n\t};\r\n\tdiscontinuousTimeScaleProvider.inputDateAccessor = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn inputDateAccessor;\r\n\t\t}\r\n\t\tinputDateAccessor = x;\r\n\t\treturn discontinuousTimeScaleProvider;\r\n\t};\r\n\tdiscontinuousTimeScaleProvider.indexAccessor = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn indexAccessor;\r\n\t\t}\r\n\t\tindexAccessor = x;\r\n\t\treturn discontinuousTimeScaleProvider;\r\n\t};\r\n\tdiscontinuousTimeScaleProvider.indexMutator = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn indexMutator;\r\n\t\t}\r\n\t\tindexMutator = x;\r\n\t\treturn discontinuousTimeScaleProvider;\r\n\t};\r\n\tdiscontinuousTimeScaleProvider.withIndex = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn withIndex;\r\n\t\t}\r\n\t\twithIndex = x;\r\n\t\treturn discontinuousTimeScaleProvider;\r\n\t};\r\n\tdiscontinuousTimeScaleProvider.utc = function() {\r\n\t\trealDateAccessor = dateAccessor => d => {\r\n\t\t\tconst date = dateAccessor(d);\r\n\t\t\t// The getTimezoneOffset() method returns the time-zone offset from UTC, in minutes, for the current locale.\r\n\t\t\tconst offsetInMillis = date.getTimezoneOffset() * 60 * 1000;\r\n\t\t\treturn new Date(date.getTime() + offsetInMillis);\r\n\t\t};\r\n\t\treturn discontinuousTimeScaleProvider;\r\n\t};\r\n\tdiscontinuousTimeScaleProvider.setLocale = function(locale, formatters = null) {\r\n\t\tif (locale) {\r\n\t\t\ttimeFormatDefaultLocale(locale);\r\n\t\t}\r\n\t\tif (formatters) {\r\n\t\t\tcurrentFormatters = formatters;\r\n\t\t}\r\n\t\treturn discontinuousTimeScaleProvider;\r\n\t};\r\n\r\n\tdiscontinuousTimeScaleProvider.indexCalculator = function() {\r\n\t\treturn doStuff(realDateAccessor, inputDateAccessor, initialIndex, currentFormatters);\r\n\t};\r\n\r\n\treturn discontinuousTimeScaleProvider;\r\n}\r\n\r\n\r\n\r\n/* discontinuousTimeScaleProvider.utc = function(data,\r\n\t\tdateAccessor,\r\n\t\tindexAccessor,\r\n\t\tindexMutator) {\r\n\tvar utcDateAccessor = d => {\r\n\t\tvar date = dateAccessor(d);\r\n\t\t// The getTimezoneOffset() method returns the time-zone offset from UTC, in minutes, for the current locale.\r\n\t\tvar offsetInMillis = date.getTimezoneOffset() * 60 * 1000;\r\n\t\treturn new Date(date.getTime() + offsetInMillis);\r\n\t};\r\n\treturn discontinuousTimeScaleProvider(data, utcDateAccessor, indexAccessor, indexMutator);\r\n};*/\r\n\r\nexport default discontinuousTimeScaleProviderBuilder();\r\n"],"mappings":"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"}