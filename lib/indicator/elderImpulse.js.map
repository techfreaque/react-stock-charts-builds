{"version":3,"file":"elderImpulse.js","names":["ALGORITHM_TYPE","macdSource","emaSource","base","baseIndicator","type","stroke","appearanceOptions","fill","undefined","underlyingAlgorithm","slidingWindow","windowSize","undefinedValue","accumulator","prev","curr","isNotDefined","Error","isDefined","prevMACDDivergence","divergence","currMACDDivergence","prevEMA","currEMA","mergedAlgorithm","merge","algorithm","datum","indicator","elderImpulse","data","options","newData","x","arguments","length","rebind"],"sources":["../../../src/lib/indicator/elderImpulse.js"],"sourcesContent":["\r\n\r\nimport { rebind, isDefined, isNotDefined, merge, slidingWindow } from \"../utils\";\r\n\r\nimport { ElderImpulse as appearanceOptions } from \"./defaultOptionsForAppearance\";\r\nimport baseIndicator from \"./baseIndicator\";\r\n\r\nconst ALGORITHM_TYPE = \"ElderImpulse\";\r\n\r\nexport default function() {\r\n\r\n\tlet macdSource, emaSource;\r\n\r\n\tconst base = baseIndicator()\r\n\t\t.type(ALGORITHM_TYPE)\r\n\t\t// .stroke(d => stroke[d.elderImpulse])\r\n\t\t.stroke(appearanceOptions.stroke)\r\n\t\t.fill(undefined);\r\n\r\n\tconst underlyingAlgorithm = slidingWindow()\r\n\t\t.windowSize(2)\r\n\t\t.undefinedValue(\"neutral\")\r\n\t\t.accumulator(([prev, curr]) => {\r\n\t\t\tif (isNotDefined(macdSource)) throw new Error(`macdSource not defined for ${ALGORITHM_TYPE} calculator`);\r\n\t\t\tif (isNotDefined(emaSource)) throw new Error(`emaSource not defined for ${ALGORITHM_TYPE} calculator`);\r\n\r\n\t\t\tif (isDefined(macdSource(prev)) && isDefined(emaSource(prev))) {\r\n\t\t\t\tconst prevMACDDivergence = macdSource(prev).divergence;\r\n\t\t\t\tconst currMACDDivergence = macdSource(curr).divergence;\r\n\r\n\t\t\t\tconst prevEMA = emaSource(prev);\r\n\t\t\t\tconst currEMA = emaSource(curr);\r\n\r\n\t\t\t\tif (currMACDDivergence >= prevMACDDivergence\r\n\t\t\t\t\t&& currEMA >= prevEMA) return \"up\";\r\n\r\n\t\t\t\tif (currMACDDivergence <= prevMACDDivergence\r\n\t\t\t\t\t&& currEMA <= prevEMA) return \"down\";\r\n\t\t\t}\r\n\t\t\treturn \"neutral\";\r\n\t\t});\r\n\r\n\tconst mergedAlgorithm = merge()\r\n\t\t.algorithm(underlyingAlgorithm)\r\n\t\t.merge((datum, indicator) => { datum.elderImpulse = indicator; });\r\n\r\n\t// eslint-disable-next-line prefer-const\r\n\tlet indicator = function(data, options = { merge: true }) {\r\n\t\tconst newData = options.merge\r\n\t\t\t? mergedAlgorithm(data)\r\n\t\t\t: underlyingAlgorithm(data);\r\n\r\n\t\treturn newData;\r\n\t};\r\n\tindicator.macdSource = function(x) {\r\n\t\tif (!arguments.length) return macdSource;\r\n\t\tmacdSource = x;\r\n\t\treturn indicator;\r\n\t};\r\n\tindicator.emaSource = function(x) {\r\n\t\tif (!arguments.length) return emaSource;\r\n\t\temaSource = x;\r\n\t\treturn indicator;\r\n\t};\r\n\trebind(indicator, base, \"id\", \"echo\", \"type\", \"stroke\");\r\n\t// rebind(indicator, underlyingAlgorithm, \"windowSize\", \"movingAverageType\", \"multiplier\", \"source\");\r\n\trebind(indicator, mergedAlgorithm, \"merge\", \"skipUndefined\");\r\n\r\n\treturn indicator;\r\n}\r\n"],"mappings":";;;;;;;AAEA;;AAEA;;AACA;;;;;;;;;;;;;;;;AAEA,IAAMA,cAAc,GAAG,cAAvB;;AAEe,oBAAW;EAEzB,IAAIC,UAAJ,EAAgBC,SAAhB;EAEA,IAAMC,IAAI,GAAG,IAAAC,yBAAA,IACXC,IADW,CACNL,cADM,EAEZ;EAFY,CAGXM,MAHW,CAGJC,yCAAA,CAAkBD,MAHd,EAIXE,IAJW,CAINC,SAJM,CAAb;EAMA,IAAMC,mBAAmB,GAAG,IAAAC,oBAAA,IAC1BC,UAD0B,CACf,CADe,EAE1BC,cAF0B,CAEX,SAFW,EAG1BC,WAH0B,CAGd,gBAAkB;IAAA;IAAA,IAAhBC,IAAgB;IAAA,IAAVC,IAAU;;IAC9B,IAAI,IAAAC,mBAAA,EAAahB,UAAb,CAAJ,EAA8B,MAAM,IAAIiB,KAAJ,sCAAwClB,cAAxC,iBAAN;IAC9B,IAAI,IAAAiB,mBAAA,EAAaf,SAAb,CAAJ,EAA6B,MAAM,IAAIgB,KAAJ,qCAAuClB,cAAvC,iBAAN;;IAE7B,IAAI,IAAAmB,gBAAA,EAAUlB,UAAU,CAACc,IAAD,CAApB,KAA+B,IAAAI,gBAAA,EAAUjB,SAAS,CAACa,IAAD,CAAnB,CAAnC,EAA+D;MAC9D,IAAMK,kBAAkB,GAAGnB,UAAU,CAACc,IAAD,CAAV,CAAiBM,UAA5C;MACA,IAAMC,kBAAkB,GAAGrB,UAAU,CAACe,IAAD,CAAV,CAAiBK,UAA5C;MAEA,IAAME,OAAO,GAAGrB,SAAS,CAACa,IAAD,CAAzB;MACA,IAAMS,OAAO,GAAGtB,SAAS,CAACc,IAAD,CAAzB;MAEA,IAAIM,kBAAkB,IAAIF,kBAAtB,IACAI,OAAO,IAAID,OADf,EACwB,OAAO,IAAP;MAExB,IAAID,kBAAkB,IAAIF,kBAAtB,IACAI,OAAO,IAAID,OADf,EACwB,OAAO,MAAP;IACxB;;IACD,OAAO,SAAP;EACA,CArB0B,CAA5B;EAuBA,IAAME,eAAe,GAAG,IAAAC,YAAA,IACtBC,SADsB,CACZjB,mBADY,EAEtBgB,KAFsB,CAEhB,UAACE,KAAD,EAAQC,SAAR,EAAsB;IAAED,KAAK,CAACE,YAAN,GAAqBD,SAArB;EAAiC,CAFzC,CAAxB,CAjCyB,CAqCzB;;EACA,IAAIA,SAAS,GAAG,SAAZA,SAAY,CAASE,IAAT,EAA0C;IAAA,IAA3BC,OAA2B,uEAAjB;MAAEN,KAAK,EAAE;IAAT,CAAiB;IACzD,IAAMO,OAAO,GAAGD,OAAO,CAACN,KAAR,GACbD,eAAe,CAACM,IAAD,CADF,GAEbrB,mBAAmB,CAACqB,IAAD,CAFtB;IAIA,OAAOE,OAAP;EACA,CAND;;EAOAJ,SAAS,CAAC5B,UAAV,GAAuB,UAASiC,CAAT,EAAY;IAClC,IAAI,CAACC,SAAS,CAACC,MAAf,EAAuB,OAAOnC,UAAP;IACvBA,UAAU,GAAGiC,CAAb;IACA,OAAOL,SAAP;EACA,CAJD;;EAKAA,SAAS,CAAC3B,SAAV,GAAsB,UAASgC,CAAT,EAAY;IACjC,IAAI,CAACC,SAAS,CAACC,MAAf,EAAuB,OAAOlC,SAAP;IACvBA,SAAS,GAAGgC,CAAZ;IACA,OAAOL,SAAP;EACA,CAJD;;EAKA,IAAAQ,aAAA,EAAOR,SAAP,EAAkB1B,IAAlB,EAAwB,IAAxB,EAA8B,MAA9B,EAAsC,MAAtC,EAA8C,QAA9C,EAvDyB,CAwDzB;;EACA,IAAAkC,aAAA,EAAOR,SAAP,EAAkBJ,eAAlB,EAAmC,OAAnC,EAA4C,eAA5C;EAEA,OAAOI,SAAP;AACA"}