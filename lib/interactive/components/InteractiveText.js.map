{"version":3,"file":"InteractiveText.js","names":["InteractiveText","props","calculateTextWidth","renderSVG","bind","drawOnCanvas","isHover","moreProps","onHover","isDefined","textWidth","helper","rect","mouseXY","x","y","width","height","nextProps","text","fontStyle","fontWeight","fontSize","fontFamily","ctx","bgFill","bgOpacity","bgStrokeWidth","bgStroke","textFill","font","measureText","selected","fillStyle","hexToRGBA","beginPath","fillRect","strokeStyle","lineWidth","strokeRect","textBaseline","textAlign","fillText","Error","interactiveCursorClass","onUnHover","onDragStart","onDrag","onDragComplete","getMouseCanvas","Component","position","xScale","yScale","chartConfig","xValue","yValue","propTypes","PropTypes","string","isRequired","number","oneOfType","func","defaultClassName","tolerance","bool","defaultProps","noop","type"],"sources":["../../../../src/lib/interactive/components/InteractiveText.js"],"sourcesContent":["import React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport GenericChartComponent from \"../../GenericChartComponent\";\r\nimport { getMouseCanvas } from \"../../GenericComponent\";\r\n\r\nimport { isDefined, noop, hexToRGBA } from \"../../utils\";\r\n\r\nclass InteractiveText extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.calculateTextWidth = true;\r\n\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t\tthis.isHover = this.isHover.bind(this);\r\n\t}\r\n\tisHover(moreProps) {\r\n\t\tconst { onHover } = this.props;\r\n\r\n\t\tif (\r\n\t\t\tisDefined(onHover)\r\n\t\t\t&& isDefined(this.textWidth)\r\n\t\t\t&& !this.calculateTextWidth\r\n\t\t) {\r\n\t\t\tconst { rect } = helper(this.props, moreProps, this.textWidth);\r\n\t\t\tconst { mouseXY: [x, y] } = moreProps;\r\n\r\n\t\t\tif (\r\n\t\t\t\tx >= rect.x\r\n\t\t\t\t&& y >= rect.y\r\n\t\t\t\t&& x <= rect.x + rect.width\r\n\t\t\t\t&& y <= rect.y + rect.height\r\n\t\t\t) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tUNSAFE_componentWillReceiveProps(nextProps) {\r\n\t\tthis.calculateTextWidth = (\r\n\t\t\tnextProps.text !== this.props.text\r\n\t\t\t|| nextProps.fontStyle !== this.props.fontStyle\r\n\t\t\t|| nextProps.fontWeight !== this.props.fontWeight\r\n\t\t\t|| nextProps.fontSize !== this.props.fontSize\r\n\t\t\t|| nextProps.fontFamily !== this.props.fontFamily\r\n\t\t);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst {\r\n\t\t\tbgFill,\r\n\t\t\tbgOpacity,\r\n\t\t\tbgStrokeWidth,\r\n\t\t\tbgStroke,\r\n\t\t\ttextFill,\r\n\t\t\tfontFamily,\r\n\t\t\tfontSize,\r\n\t\t\tfontStyle,\r\n\t\t\tfontWeight,\r\n\t\t\ttext,\r\n\t\t} = this.props;\r\n\r\n\t\tif (this.calculateTextWidth) {\r\n\t\t\tctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${fontFamily}`;\r\n\t\t\tconst { width } = ctx.measureText(text);\r\n\t\t\tthis.textWidth = width;\r\n\t\t\tthis.calculateTextWidth = false;\r\n\t\t}\r\n\r\n\t\tconst { selected } = this.props;\r\n\r\n\t\tconst { x, y, rect } = helper(this.props, moreProps, this.textWidth);\r\n\r\n\t\tctx.fillStyle = hexToRGBA(bgFill, bgOpacity);\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.fillRect(rect.x, rect.y, rect.width, rect.height);\r\n\r\n\t\tif (selected) {\r\n\t\t\tctx.strokeStyle = bgStroke;\r\n\t\t\tctx.lineWidth = bgStrokeWidth;\r\n\t\t\tctx.strokeRect(rect.x, rect.y, rect.width, rect.height);\r\n\t\t}\r\n\r\n\t\tctx.fillStyle = textFill;\r\n\t\tctx.textBaseline = \"middle\";\r\n\t\tctx.textAlign = \"center\";\r\n\t\tctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${fontFamily}`;\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.fillText(text, x, y);\r\n\t}\r\n\trenderSVG() {\r\n\t\tthrow new Error(\"svg not implemented\");\r\n\t}\r\n\trender() {\r\n\t\tconst { selected, interactiveCursorClass } = this.props;\r\n\t\tconst { onHover, onUnHover } = this.props;\r\n\t\tconst { onDragStart, onDrag, onDragComplete } = this.props;\r\n\r\n\t\treturn <GenericChartComponent\r\n\t\t\tisHover={this.isHover}\r\n\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasToDraw={getMouseCanvas}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\r\n\t\t\tinteractiveCursorClass={interactiveCursorClass}\r\n\t\t\tselected={selected}\r\n\r\n\t\t\tonDragStart={onDragStart}\r\n\t\t\tonDrag={onDrag}\r\n\t\t\tonDragComplete={onDragComplete}\r\n\t\t\tonHover={onHover}\r\n\t\t\tonUnHover={onUnHover}\r\n\r\n\t\t\tdrawOn={[\"mousemove\", \"mouseleave\", \"pan\", \"drag\"]}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nfunction helper(props, moreProps, textWidth) {\r\n\tconst { position, fontSize } = props;\r\n\r\n\tconst { xScale, chartConfig: { yScale } } = moreProps;\r\n\r\n\tconst [xValue, yValue] = position;\r\n\tconst x = xScale(xValue);\r\n\tconst y = yScale(yValue);\r\n\r\n\tconst rect = {\r\n\t\tx: x - textWidth / 2 - fontSize,\r\n\t\ty: y - fontSize,\r\n\t\twidth: textWidth + fontSize * 2,\r\n\t\theight: fontSize * 2,\r\n\t};\r\n\r\n\treturn {\r\n\t\tx, y, rect\r\n\t};\r\n}\r\n\r\nInteractiveText.propTypes = {\r\n\tbgFill: PropTypes.string.isRequired,\r\n\tbgOpacity: PropTypes.number.isRequired,\r\n\tbgStrokeWidth: PropTypes.number.isRequired,\r\n\tbgStroke: PropTypes.string.isRequired,\r\n\r\n\ttextFill: PropTypes.string.isRequired,\r\n\tfontFamily: PropTypes.string.isRequired,\r\n\tfontSize: PropTypes.number.isRequired,\r\n\tfontWeight: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.string,\r\n\t]).isRequired,\r\n\tfontStyle: PropTypes.string.isRequired,\r\n\r\n\ttext: PropTypes.string.isRequired,\r\n\r\n\tonDragStart: PropTypes.func.isRequired,\r\n\tonDrag: PropTypes.func.isRequired,\r\n\tonDragComplete: PropTypes.func.isRequired,\r\n\tonHover: PropTypes.func,\r\n\tonUnHover: PropTypes.func,\r\n\r\n\tdefaultClassName: PropTypes.string,\r\n\tinteractiveCursorClass: PropTypes.string,\r\n\r\n\ttolerance: PropTypes.number.isRequired,\r\n\tselected: PropTypes.bool.isRequired,\r\n};\r\n\r\nInteractiveText.defaultProps = {\r\n\tonDragStart: noop,\r\n\tonDrag: noop,\r\n\tonDragComplete: noop,\r\n\r\n\ttype: \"SD\", // standard dev\r\n\tfontWeight: \"normal\", // standard dev\r\n\r\n\ttolerance: 4,\r\n\tselected: false,\r\n};\r\n\r\nexport default InteractiveText;"],"mappings":"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"}