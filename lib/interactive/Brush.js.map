{"version":3,"file":"Brush.js","names":["Brush","props","context","handleZoomStart","bind","handleDrawSquare","handleZoomComplete","drawOnCanvas","renderSVG","saveNode","terminate","state","rect","zoomHappening","setState","x1y1","start","end","node","ctx","isDefined","x","y","height","width","stroke","fill","strokeDashArray","strokeOpacity","fillOpacity","dashArray","getStrokeDasharray","split","map","d","strokeStyle","hexToRGBA","fillStyle","setLineDash","beginPath","fillRect","strokeRect","moreProps","mouseXY","mouseY","currentItem","yScale","chartConfig","xAccessor","xScale","selected","item","xValue","yValue","invert","x2","y2","x1","y1","Math","min","abs","onBrush","enabled","getMouseCanvas","Component","propTypes","PropTypes","bool","isRequired","onStart","func","type","oneOf","string","number","interactiveState","object","defaultProps","noop"],"sources":["../../../src/lib/interactive/Brush.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport {\r\n\tisDefined,\r\n\tnoop,\r\n\tgetStrokeDasharray,\r\n\thexToRGBA,\r\n} from \"../utils\";\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getMouseCanvas } from \"../GenericComponent\";\r\n\r\nclass Brush extends Component {\r\n\tconstructor(props, context) {\r\n\t\tsuper(props, context);\r\n\t\tthis.handleZoomStart = this.handleZoomStart.bind(this);\r\n\t\tthis.handleDrawSquare = this.handleDrawSquare.bind(this);\r\n\t\tthis.handleZoomComplete = this.handleZoomComplete.bind(this);\r\n\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.saveNode = this.saveNode.bind(this);\r\n\t\tthis.terminate = this.terminate.bind(this);\r\n\t\tthis.state = {\r\n\t\t\trect: null,\r\n\t\t};\r\n\t}\r\n\tterminate() {\r\n\t\tthis.zoomHappening = false;\r\n\t\tthis.setState({\r\n\t\t\tx1y1: null,\r\n\t\t\tstart: null,\r\n\t\t\tend: null,\r\n\t\t\trect: null,\r\n\t\t});\r\n\t}\r\n\tsaveNode(node) {\r\n\t\tthis.node = node;\r\n\t}\r\n\tdrawOnCanvas(ctx) {\r\n\t\tconst { rect } = this.state;\r\n\t\tif (isDefined(rect)) {\r\n\t\t\tconst { x, y, height, width } = rect;\r\n\t\t\tconst { stroke, fill, strokeDashArray } = this.props;\r\n\t\t\tconst { strokeOpacity, fillOpacity } = this.props;\r\n\r\n\t\t\tconst dashArray = getStrokeDasharray(strokeDashArray)\r\n\t\t\t\t.split(\",\")\r\n\t\t\t\t.map(d => +d);\r\n\r\n\t\t\tctx.strokeStyle = hexToRGBA(stroke, strokeOpacity);\r\n\t\t\tctx.fillStyle = hexToRGBA(fill, fillOpacity);\r\n\t\t\tctx.setLineDash(dashArray);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillRect(x, y, width, height);\r\n\t\t\tctx.strokeRect(x, y, width, height);\r\n\t\t}\r\n\t}\r\n\trenderSVG() {\r\n\t\tconst { rect } = this.state;\r\n\t\tif (isDefined(rect)) {\r\n\t\t\tconst { x, y, height, width } = rect;\r\n\t\t\tconst { stroke, strokeDashArray } = this.props;\r\n\t\t\tconst { strokeOpacity, fillOpacity } = this.props;\r\n\r\n\t\t\tconst dashArray = getStrokeDasharray(strokeDashArray)\r\n\t\t\t\t.split(\",\")\r\n\t\t\t\t.map(d => +d);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<rect strokeDasharray={dashArray}\r\n\t\t\t\t\tstroke={stroke}\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\tstrokeOpacity={strokeOpacity}\r\n\t\t\t\t\tfillOpacity={fillOpacity}\r\n\t\t\t\t\tx={x}\r\n\t\t\t\t\ty={y}\r\n\t\t\t\t\twidth={width}\r\n\t\t\t\t\theight={height}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\thandleZoomStart(moreProps) {\r\n\t\tthis.zoomHappening = false;\r\n\t\tconst {\r\n\t\t\tmouseXY: [, mouseY],\r\n\t\t\tcurrentItem,\r\n\t\t\tchartConfig: { yScale },\r\n\t\t\txAccessor,\r\n\t\t\txScale,\r\n\t\t} = moreProps;\r\n\r\n\t\tconst x1y1 = [\r\n\t\t\txScale(xAccessor(currentItem)),\r\n\t\t\tmouseY\r\n\t\t];\r\n\r\n\t\tthis.setState({\r\n\t\t\tselected: true,\r\n\t\t\tx1y1,\r\n\t\t\tstart: {\r\n\t\t\t\titem: currentItem,\r\n\t\t\t\txValue: xAccessor(currentItem),\r\n\t\t\t\tyValue: yScale.invert(mouseY),\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\thandleDrawSquare(moreProps) {\r\n\t\tif (this.state.x1y1 == null) return;\r\n\r\n\t\tthis.zoomHappening = true;\r\n\r\n\t\tconst {\r\n\t\t\tmouseXY: [, mouseY],\r\n\t\t\tcurrentItem,\r\n\t\t\tchartConfig: { yScale },\r\n\t\t\txAccessor,\r\n\t\t\txScale,\r\n\t\t} = moreProps;\r\n\r\n\t\tconst [x2, y2] = [\r\n\t\t\txScale(xAccessor(currentItem)),\r\n\t\t\tmouseY\r\n\t\t];\r\n\r\n\t\tconst { x1y1: [x1, y1] } = this.state;\r\n\r\n\t\tconst x = Math.min(x1, x2);\r\n\t\tconst y = Math.min(y1, y2);\r\n\t\tconst height = Math.abs(y2 - y1);\r\n\t\tconst width = Math.abs(x2 - x1);\r\n\r\n\t\tthis.setState({\r\n\t\t\tselected: true,\r\n\t\t\tend: {\r\n\t\t\t\titem: currentItem,\r\n\t\t\t\txValue: xAccessor(currentItem),\r\n\t\t\t\tyValue: yScale.invert(mouseY),\r\n\t\t\t},\r\n\t\t\trect: {\r\n\t\t\t\tx, y, height, width\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\thandleZoomComplete(moreProps) {\r\n\t\tif (this.zoomHappening) {\r\n\t\t\tconst { onBrush } = this.props;\r\n\t\t\tconst { start, end } = this.state;\r\n\t\t\tonBrush({ start, end }, moreProps);\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tselected: false,\r\n\t\t\trect: null,\r\n\t\t});\r\n\t}\r\n\trender() {\r\n\t\tconst { enabled } = this.props;\r\n\t\tif (!enabled) return null;\r\n\r\n\t\treturn (\r\n\t\t\t<GenericChartComponent\r\n\t\t\t\tref={this.saveNode}\r\n\t\t\t\tdisablePan={enabled}\r\n\r\n\t\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\t\tcanvasToDraw={getMouseCanvas}\r\n\t\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\r\n\t\t\t\tonMouseDown={this.handleZoomStart}\r\n\t\t\t\tonMouseMove={this.handleDrawSquare}\r\n\t\t\t\tonClick={this.handleZoomComplete}\r\n\r\n\t\t\t\tdrawOn={[\"mousemove\", \"pan\", \"drag\"]}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nBrush.propTypes = {\r\n\tenabled: PropTypes.bool.isRequired,\r\n\tonStart: PropTypes.func.isRequired,\r\n\tonBrush: PropTypes.func.isRequired,\r\n\r\n\ttype: PropTypes.oneOf([\"1D\", \"2D\"]),\r\n\tstroke: PropTypes.string,\r\n\tfill: PropTypes.string,\r\n\tstrokeOpacity: PropTypes.number,\r\n\tfillOpacity: PropTypes.number,\r\n\tinteractiveState: PropTypes.object,\r\n\tstrokeDashArray: PropTypes.string,\r\n};\r\n\r\nBrush.defaultProps = {\r\n\ttype: \"2D\",\r\n\tstroke: \"#000000\",\r\n\tfillOpacity: 0.3,\r\n\tstrokeOpacity: 1,\r\n\tfill: \"#3h3h3h\",\r\n\tonBrush: noop,\r\n\tonStart: noop,\r\n\tstrokeDashArray: \"ShortDash\",\r\n};\r\n\r\nexport default Brush;\r\n"],"mappings":"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"}