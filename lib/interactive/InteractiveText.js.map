{"version":3,"file":"InteractiveText.js","names":["InteractiveText","props","handleDraw","bind","handleDrag","handleDragComplete","terminate","saveNodeType","getSelectionState","isHoverForInteractiveType","nodes","state","index","position","setState","override","moreProps","isDefined","textList","newTextList","map","each","idx","selected","onDragComplete","xyValue","current","start","end","e","enabled","mouseXY","mouseY","yScale","chartConfig","xAccessor","currentItem","invert","defaultText","onChoosePosition","newText","hoverText","defaultHoverText","defaultProps","getValueFromOverride","noop","getMouseCanvas","Component","propTypes","PropTypes","func","isRequired","onSelect","shape","bgFill","string","bgOpacity","number","bgStrokeWidth","bgStroke","textFill","fontFamily","fontWeight","fontStyle","fontSize","text","object","array","bool","HoverTextNearMouse","enable","bgHeight","bgWidth","selectedText","contextTypes","subscribe","unsubscribe","generateSubscriptionId","chartId","oneOfType"],"sources":["../../../src/lib/interactive/InteractiveText.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport { isDefined, noop } from \"../utils\";\r\n\r\nimport {\r\n\tgetValueFromOverride,\r\n\tterminate,\r\n\tsaveNodeType,\r\n\tisHoverForInteractiveType,\r\n} from \"./utils\";\r\nimport EachText from \"./wrapper/EachText\";\r\nimport HoverTextNearMouse from \"./components/HoverTextNearMouse\";\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getMouseCanvas } from \"../GenericComponent\";\r\n\r\nclass InteractiveText extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.handleDraw = this.handleDraw.bind(this);\r\n\t\tthis.handleDrag = this.handleDrag.bind(this);\r\n\t\tthis.handleDragComplete = this.handleDragComplete.bind(this);\r\n\t\tthis.terminate = terminate.bind(this);\r\n\r\n\t\tthis.saveNodeType = saveNodeType.bind(this);\r\n\t\tthis.getSelectionState = isHoverForInteractiveType(\"textList\")\r\n\t\t\t.bind(this);\r\n\r\n\t\tthis.nodes = [];\r\n\t\tthis.state = {};\r\n\t}\r\n\thandleDrag(index, position) {\r\n\t\tthis.setState({\r\n\t\t\toverride: {\r\n\t\t\t\tindex,\r\n\t\t\t\tposition,\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\thandleDragComplete(moreProps) {\r\n\t\tconst { override } = this.state;\r\n\t\tif (isDefined(override)) {\r\n\t\t\tconst { textList } = this.props;\r\n\t\t\tconst newTextList = textList\r\n\t\t\t\t.map((each, idx) => {\r\n\t\t\t\t\tconst selected = (idx === override.index);\r\n\t\t\t\t\treturn selected\r\n\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t...each,\r\n\t\t\t\t\t\t\tposition: override.position,\r\n\t\t\t\t\t\t\tselected,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t: {\r\n\t\t\t\t\t\t\t...each,\r\n\t\t\t\t\t\t\tselected\r\n\t\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\tthis.setState({\r\n\t\t\t\toverride: null,\r\n\t\t\t}, () => {\r\n\t\t\t\tthis.props.onDragComplete(newTextList, moreProps);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleDrawLine(xyValue) {\r\n\t\tconst { current } = this.state;\r\n\r\n\t\tif (isDefined(current) && isDefined(current.start)) {\r\n\t\t\tthis.setState({\r\n\t\t\t\tcurrent: {\r\n\t\t\t\t\tstart: current.start,\r\n\t\t\t\t\tend: xyValue,\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleDraw(moreProps, e) {\r\n\t\tconst { enabled } = this.props;\r\n\t\tif (enabled) {\r\n\t\t\tconst {\r\n\t\t\t\tmouseXY: [, mouseY],\r\n\t\t\t\tchartConfig: { yScale },\r\n\t\t\t\txAccessor,\r\n\t\t\t\tcurrentItem,\r\n\t\t\t} = moreProps;\r\n\r\n\t\t\tconst xyValue = [xAccessor(currentItem), yScale.invert(mouseY)];\r\n\r\n\t\t\tconst { defaultText, onChoosePosition } = this.props;\r\n\r\n\t\t\tconst newText = {\r\n\t\t\t\t...defaultText,\r\n\t\t\t\tposition: xyValue,\r\n\t\t\t};\r\n\t\t\tonChoosePosition(newText, moreProps, e);\r\n\t\t}/*  else {\r\n\t\t\tthis.handleClick(moreProps, e);\r\n\t\t} */\r\n\t}\r\n\trender() {\r\n\t\tconst { textList, defaultText, hoverText } = this.props;\r\n\t\tconst { override } = this.state;\r\n\t\treturn <g>\r\n\t\t\t{textList.map((each, idx) => {\r\n\t\t\t\tconst defaultHoverText = InteractiveText.defaultProps.hoverText;\r\n\t\t\t\tconst props = {\r\n\t\t\t\t\t...defaultText,\r\n\t\t\t\t\t...each,\r\n\t\t\t\t\thoverText: {\r\n\t\t\t\t\t\t...defaultHoverText,\r\n\t\t\t\t\t\t...hoverText,\r\n\t\t\t\t\t\t...(each.hoverText || {})\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t\treturn <EachText key={idx}\r\n\t\t\t\t\tref={this.saveNodeType(idx)}\r\n\t\t\t\t\tindex={idx}\r\n\t\t\t\t\t{...props}\r\n\t\t\t\t\tselected={each.selected}\r\n\t\t\t\t\tposition={getValueFromOverride(override, idx, \"position\", each.position)}\r\n\r\n\t\t\t\t\tonDrag={this.handleDrag}\r\n\t\t\t\t\tonDragComplete={this.handleDragComplete}\r\n\t\t\t\t\tedgeInteractiveCursor=\"react-stockcharts-move-cursor\"\r\n\t\t\t\t/>;\r\n\t\t\t})}\r\n\t\t\t<GenericChartComponent\r\n\r\n\t\t\t\tonClick={this.handleDraw}\r\n\r\n\t\t\t\tsvgDraw={noop}\r\n\t\t\t\tcanvasDraw={noop}\r\n\t\t\t\tcanvasToDraw={getMouseCanvas}\r\n\r\n\t\t\t\tdrawOn={[\"mousemove\", \"pan\"]}\r\n\t\t\t/>;\r\n\t\t</g>;\r\n\t}\r\n}\r\n\r\nInteractiveText.propTypes = {\r\n\tonChoosePosition: PropTypes.func.isRequired,\r\n\tonDragComplete: PropTypes.func.isRequired,\r\n\tonSelect: PropTypes.func,\r\n\r\n\tdefaultText: PropTypes.shape({\r\n\t\tbgFill: PropTypes.string.isRequired,\r\n\t\tbgOpacity: PropTypes.number.isRequired,\r\n\t\tbgStrokeWidth: PropTypes.number,\r\n\t\tbgStroke: PropTypes.string,\r\n\t\ttextFill: PropTypes.string.isRequired,\r\n\t\tfontFamily: PropTypes.string.isRequired,\r\n\t\tfontWeight: PropTypes.string.isRequired,\r\n\t\tfontStyle: PropTypes.string.isRequired,\r\n\t\tfontSize: PropTypes.number.isRequired,\r\n\t\ttext: PropTypes.string.isRequired,\r\n\t}).isRequired,\r\n\r\n\thoverText: PropTypes.object.isRequired,\r\n\ttextList: PropTypes.array.isRequired,\r\n\tenabled: PropTypes.bool.isRequired,\r\n};\r\n\r\nInteractiveText.defaultProps = {\r\n\tonChoosePosition: noop,\r\n\tonDragComplete: noop,\r\n\tonSelect: noop,\r\n\r\n\tdefaultText: {\r\n\t\tbgFill: \"#D3D3D3\",\r\n\t\tbgOpacity: 1,\r\n\t\tbgStrokeWidth: 1,\r\n\t\ttextFill: \"#F10040\",\r\n\t\tfontFamily: \"Helvetica Neue, Helvetica, Arial, sans-serif\",\r\n\t\tfontSize: 12,\r\n\t\tfontStyle: \"normal\",\r\n\t\tfontWeight: \"normal\",\r\n\t\ttext: \"Lorem ipsum...\"\r\n\t},\r\n\thoverText: {\r\n\t\t...HoverTextNearMouse.defaultProps,\r\n\t\tenable: true,\r\n\t\tbgHeight: \"auto\",\r\n\t\tbgWidth: \"auto\",\r\n\t\ttext: \"Click to select object\",\r\n\t\tselectedText: \"\",\r\n\t},\r\n\ttextList: [],\r\n};\r\n\r\nInteractiveText.contextTypes = {\r\n\tsubscribe: PropTypes.func.isRequired,\r\n\tunsubscribe: PropTypes.func.isRequired,\r\n\tgenerateSubscriptionId: PropTypes.func.isRequired,\r\n\tchartId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\r\n};\r\n\r\nexport default InteractiveText;\r\n"],"mappings":"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"}