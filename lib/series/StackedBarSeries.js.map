{"version":3,"file":"StackedBarSeries.js","names":["StackedBarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","drawOnCanvasHelper","d3Stack","svgHelper","clip","getAxisCanvas","Component","propTypes","baseAt","PropTypes","oneOfType","number","func","isRequired","direction","oneOf","stroke","bool","width","opacity","fill","string","className","defaultProps","xScale","yScale","head","range","plotDataLengthBarWidth","widthRatio","swapScales","identityStack","keys","stack","data","response","map","key","i","arrays","d","array","index","x","arguments","length","stackFn","defaultPostAction","identity","postRotateAction","rotateXY","chartConfig","plotData","bars","doStuff","drawOnCanvas2","convertToArray","item","Array","isArray","getBarsSVG2","yAccessor","modifiedYAccessor","modifiedXAccessor","modifiedXScale","modifiedYScale","postProcessor","getBars","each","y","height","idx","nest","d3Nest","entries","forEach","outer","values","strokeStyle","fillStyle","hexToRGBA","fillRect","strokeRect","after","spaceBetweenBar","getClassName","functor","getFill","getBase","widthFunctor","barWidth","Math","round","eachBarWidth","offset","ds","appearance","eachYAccessor","_","newData","merge","h","groupOffset","groupWidth","filter","bar","isNaN"],"sources":["../../../src/lib/series/StackedBarSeries.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport { nest as d3Nest } from \"d3-collection\";\r\nimport { merge } from \"d3-array\";\r\nimport { stack as d3Stack } from \"d3-shape\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport { identity, hexToRGBA, head, functor, plotDataLengthBarWidth } from \"../utils\";\r\n\r\nclass StackedBarSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\t\t// var { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\t\tdrawOnCanvasHelper(ctx, this.props, moreProps, xAccessor, d3Stack);\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\r\n\t\treturn <g>{svgHelper(this.props, moreProps, xAccessor, d3Stack)}</g>;\r\n\t}\r\n\trender() {\r\n\t\tconst { clip } = this.props;\r\n\r\n\t\treturn <GenericChartComponent\r\n\t\t\tclip={clip}\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nStackedBarSeries.propTypes = {\r\n\tbaseAt: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func,\r\n\t]).isRequired,\r\n\tdirection: PropTypes.oneOf([\"up\", \"down\"]).isRequired,\r\n\tstroke: PropTypes.bool.isRequired,\r\n\twidth: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func\r\n\t]).isRequired,\r\n\topacity: PropTypes.number.isRequired,\r\n\tfill: PropTypes.oneOfType([\r\n\t\tPropTypes.func, PropTypes.string\r\n\t]).isRequired,\r\n\tclassName: PropTypes.oneOfType([\r\n\t\tPropTypes.func, PropTypes.string\r\n\t]).isRequired,\r\n\tclip: PropTypes.bool.isRequired,\r\n};\r\n\r\nStackedBarSeries.defaultProps = {\r\n\tbaseAt: (xScale, yScale/* , d*/) => head(yScale.range()),\r\n\tdirection: \"up\",\r\n\tclassName: \"bar\",\r\n\tstroke: true,\r\n\tfill: \"#4682B4\",\r\n\topacity: 0.5,\r\n\twidth: plotDataLengthBarWidth,\r\n\twidthRatio: 0.8,\r\n\tclip: true,\r\n\tswapScales: false,\r\n};\r\n\r\nexport function identityStack() {\r\n\tlet keys = [];\r\n\tfunction stack(data) {\r\n\t\tconst response = keys.map((key, i) => {\r\n\t\t\t// eslint-disable-next-line prefer-const\r\n\t\t\tlet arrays = data.map(d => {\r\n\t\t\t\t// eslint-disable-next-line prefer-const\r\n\t\t\t\tlet array = [0, d[key]];\r\n\t\t\t\tarray.data = d;\r\n\t\t\t\treturn array;\r\n\t\t\t});\r\n\t\t\tarrays.key = key;\r\n\t\t\tarrays.index = i;\r\n\t\t\treturn arrays;\r\n\t\t});\r\n\t\treturn response;\r\n\t}\r\n\tstack.keys = function(x) {\r\n\t\tif (!arguments.length) {\r\n\t\t\treturn keys;\r\n\t\t}\r\n\t\tkeys = x;\r\n\t\treturn stack;\r\n\t};\r\n\treturn stack;\r\n}\r\n\r\n\r\nexport function drawOnCanvasHelper(ctx, props, moreProps, xAccessor, stackFn, defaultPostAction = identity, postRotateAction = rotateXY) {\r\n\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\tconst bars = doStuff(props, xAccessor, plotData, xScale, yScale, stackFn, postRotateAction, defaultPostAction);\r\n\r\n\tdrawOnCanvas2(props, ctx, bars);\r\n}\r\n\r\nfunction convertToArray(item) {\r\n\treturn Array.isArray(item) ? item : [item];\r\n}\r\n\r\nexport function svgHelper(props, moreProps, xAccessor, stackFn, defaultPostAction = identity, postRotateAction = rotateXY) {\r\n\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\tconst bars = doStuff(props, xAccessor, plotData, xScale, yScale, stackFn, postRotateAction, defaultPostAction);\r\n\treturn getBarsSVG2(props, bars);\r\n}\r\n\r\nfunction doStuff(props, xAccessor, plotData, xScale, yScale, stackFn, postRotateAction, defaultPostAction) {\r\n\tconst { yAccessor, swapScales } = props;\r\n\r\n\tconst modifiedYAccessor = swapScales ? convertToArray(props.xAccessor) : convertToArray(yAccessor);\r\n\tconst modifiedXAccessor = swapScales ? yAccessor : xAccessor;\r\n\r\n\tconst modifiedXScale = swapScales ? yScale : xScale;\r\n\tconst modifiedYScale = swapScales ? xScale : yScale;\r\n\r\n\tconst postProcessor =  swapScales ? postRotateAction : defaultPostAction;\r\n\r\n\tconst bars = getBars(props, modifiedXAccessor, modifiedYAccessor, modifiedXScale, modifiedYScale, plotData, stackFn, postProcessor);\r\n\r\n\treturn bars;\r\n}\r\n\r\nexport const rotateXY = (array) => array.map(each => {\r\n\treturn {\r\n\t\t...each,\r\n\t\tx: each.y,\r\n\t\ty: each.x,\r\n\t\theight: each.width,\r\n\t\twidth: each.height\r\n\t};\r\n});\r\n\r\nexport function getBarsSVG2(props, bars) {\r\n\t/* eslint-disable react/prop-types */\r\n\tconst { opacity } = props;\r\n\t/* eslint-enable react/prop-types */\r\n\r\n\treturn bars.map((d, idx) => {\r\n\t\tif (d.width <= 1) {\r\n\t\t\treturn <line key={idx} className={d.className}\r\n\t\t\t\tstroke={d.fill}\r\n\t\t\t\tx1={d.x} y1={d.y}\r\n\t\t\t\tx2={d.x} y2={d.y + d.height} />;\r\n\t\t}\r\n\t\treturn <rect key={idx} className={d.className}\r\n\t\t\tstroke={d.stroke}\r\n\t\t\tfillRule={d.fill}\r\n\t\t\tx={d.x}\r\n\t\t\ty={d.y}\r\n\t\t\twidth={d.width}\r\n\t\t\tfillOpacity={opacity}\r\n\t\t\theight={d.height} />;\r\n\t});\r\n}\r\n\r\nexport function drawOnCanvas2(props, ctx, bars) {\r\n\tconst { stroke } = props;\r\n\r\n\tconst nest = d3Nest()\r\n\t\t.key(d => d.fill)\r\n\t\t.entries(bars);\r\n\r\n\tnest.forEach(outer => {\r\n\t\tconst { key, values } = outer;\r\n\t\tif (head(values).width > 1) {\r\n\t\t\tctx.strokeStyle = key;\r\n\t\t}\r\n\t\tconst fillStyle = head(values).width <= 1\r\n\t\t\t? key\r\n\t\t\t: hexToRGBA(key, props.opacity);\r\n\t\tctx.fillStyle = fillStyle;\r\n\r\n\t\tvalues.forEach(d => {\r\n\t\t\tif (d.width <= 1) {\r\n\t\t\t\t/* <line key={idx} className={d.className}\r\n\t\t\t\t\t\t\tstroke={stroke}\r\n\t\t\t\t\t\t\tfillRule={fill}\r\n\t\t\t\t\t\t\tx1={d.x} y1={d.y}\r\n\t\t\t\t\t\t\tx2={d.x} y2={d.y + d.height} />*/\r\n\t\t\t\t/*\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(d.x, d.y);\r\n\t\t\t\tctx.lineTo(d.x, d.y + d.height);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\t*/\r\n\t\t\t\tctx.fillRect(d.x - 0.5, d.y, 1, d.height);\r\n\t\t\t} else {\r\n\t\t\t\t/* <rect key={idx} className={d.className}\r\n\t\t\t\t\t\tstroke={stroke}\r\n\t\t\t\t\t\tfillRule={fill}\r\n\t\t\t\t\t\tx={d.x}\r\n\t\t\t\t\t\ty={d.y}\r\n\t\t\t\t\t\twidth={d.width}\r\n\t\t\t\t\t\theight={d.height} /> */\r\n\t\t\t\t/*\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.rect(d.x, d.y, d.width, d.height);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\t*/\r\n\t\t\t\tctx.fillRect(d.x, d.y, d.width, d.height);\r\n\t\t\t\tif (stroke) ctx.strokeRect(d.x, d.y, d.width, d.height);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport function getBars(props, xAccessor, yAccessor, xScale, yScale, plotData, stack = identityStack, after = identity) {\r\n\tconst { baseAt, className, fill, stroke, spaceBetweenBar = 0 } = props;\r\n\r\n\tconst getClassName = functor(className);\r\n\tconst getFill = functor(fill);\r\n\tconst getBase = functor(baseAt);\r\n\r\n\tconst widthFunctor = functor(props.width);\r\n\tconst width = widthFunctor(props, {\r\n\t\txScale,\r\n\t\txAccessor,\r\n\t\tplotData\r\n\t});\r\n\r\n\tconst barWidth = Math.round(width);\r\n\r\n\tconst eachBarWidth = (barWidth - spaceBetweenBar * (yAccessor.length - 1)) / yAccessor.length;\r\n\r\n\tconst offset = (barWidth === 1 ? 0 : 0.5 * width);\r\n\r\n\tconst ds = plotData\r\n\t\t.map(each => {\r\n\t\t\t// eslint-disable-next-line prefer-const\r\n\t\t\tlet d = {\r\n\t\t\t\tappearance: {\r\n\t\t\t\t},\r\n\t\t\t\tx: xAccessor(each),\r\n\t\t\t};\r\n\t\t\tyAccessor.forEach((eachYAccessor, i) => {\r\n\t\t\t\tconst key = `y${i}`;\r\n\t\t\t\td[key] = eachYAccessor(each);\r\n\t\t\t\tconst appearance = {\r\n\t\t\t\t\tclassName: getClassName(each, i),\r\n\t\t\t\t\tstroke: stroke ? getFill(each, i) : \"none\",\r\n\t\t\t\t\tfill: getFill(each, i),\r\n\t\t\t\t};\r\n\t\t\t\td.appearance[key] = appearance;\r\n\t\t\t});\r\n\t\t\treturn d;\r\n\t\t});\r\n\r\n\tconst keys = yAccessor.map((_, i) => `y${i}`);\r\n\r\n\t// console.log(ds);\r\n\r\n\tconst data = stack().keys(keys)(ds);\r\n\r\n\t// console.log(data);\r\n\r\n\tconst newData = data.map((each, i) => {\r\n\t\tconst key = each.key;\r\n\t\treturn each.map((d) => {\r\n\t\t\t// eslint-disable-next-line prefer-const\r\n\t\t\tlet array = [d[0], d[1]];\r\n\t\t\tarray.data = {\r\n\t\t\t\tx: d.data.x,\r\n\t\t\t\ti,\r\n\t\t\t\tappearance: d.data.appearance[key]\r\n\t\t\t};\r\n\t\t\treturn array;\r\n\t\t});\r\n\t});\r\n\t// console.log(newData);\r\n\t// console.log(merge(newData));\r\n\r\n\tconst bars = merge(newData)\r\n\t\t// .filter(d => isDefined(d.y))\r\n\t\t.map(d => {\r\n\t\t\t// let baseValue = yScale.invert(getBase(xScale, yScale, d.datum));\r\n\t\t\tlet y = yScale(d[1]);\r\n\t\t\t/* let h = isDefined(d.y0) && d.y0 !== 0 && !isNaN(d.y0)\r\n\t\t\t\t\t? yScale(d.y0) - y\r\n\t\t\t\t\t: getBase(xScale, yScale, d.datum) - yScale(d.y)*/\r\n\t\t\tlet h = getBase(xScale, yScale, d.data) - yScale(d[1] - d[0]);\r\n\t\t\t// console.log(d.y, yScale.domain(), yScale.range())\r\n\t\t\t// let h = ;\r\n\t\t\t// if (d.y < 0) h = -h;\r\n\t\t\t// console.log(d, y, h)\r\n\t\t\tif (h < 0) {\r\n\t\t\t\ty = y + h;\r\n\t\t\t\th = -h;\r\n\t\t\t}\r\n\t\t\t// console.log(d.data.i, Math.round(offset - (d.data.i > 0 ? (eachBarWidth + spaceBetweenBar) * d.data.i : 0)))\r\n\t\t\t/* console.log(d.series, d.datum.date, d.x,\r\n\t\t\t\t\tgetBase(xScale, yScale, d.datum), `d.y=${d.y}, d.y0=${d.y0}, y=${y}, h=${h}`)*/\r\n\t\t\treturn {\r\n\t\t\t\t...d.data.appearance,\r\n\t\t\t\t// series: d.series,\r\n\t\t\t\t// i: d.x,\r\n\t\t\t\tx: Math.round(xScale(d.data.x) - width / 2),\r\n\t\t\t\ty: y,\r\n\t\t\t\tgroupOffset: Math.round(offset - (d.data.i > 0 ? (eachBarWidth + spaceBetweenBar) * d.data.i : 0)),\r\n\t\t\t\tgroupWidth: Math.round(eachBarWidth),\r\n\t\t\t\toffset: Math.round(offset),\r\n\t\t\t\theight: h,\r\n\t\t\t\twidth: barWidth,\r\n\t\t\t};\r\n\t\t})\r\n\t\t.filter(bar => !isNaN(bar.y));\r\n\r\n\treturn after(bars);\r\n}\r\n\r\nexport default StackedBarSeries;\r\n"],"mappings":"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"}