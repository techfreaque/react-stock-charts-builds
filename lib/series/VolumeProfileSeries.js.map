{"version":3,"file":"VolumeProfileSeries.js","names":["VolumeProfileSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","width","helper","rects","sessionBg","getAxisCanvas","className","opacity","showSessionBackground","sessionBackGround","sessionBackGroundOpacity","sessionBgSvg","map","d","idx","i","x","y","w1","height","fill1","stroke1","w2","fill2","stroke2","Component","propTypes","PropTypes","string","number","bool","defaultProps","bins","maxProfileWidthPercent","fill","type","stroke","source","close","volume","absoluteChange","bySession","sessionStart","plotData","date","getMonth","orient","partialStartOK","partialEndOK","realXScale","xScale","yScale","chartConfig","sessionBuilder","accumulatingWindow","discardTillStart","discardTillEnd","accumulateTill","accumulator","identity","dx","length","head","sessions","allRects","session","begin","finish","last","sessionWidth","histogram2","d3Histogram","value","thresholds","rollup","nest","key","direction","sortKeys","descending","ascending","leaves","sum","values","volumeInBins","arr","entries","volumeValues","each","base","range","start","end","scaleLinear","domain","max","totalVolumes","volumes","totalVolume","totalVolumeX","ws","Math","abs","zip","x1","x0","functor","merge","fillStyle","hexToRGBA","forEach","beginPath","rect","closePath","strokeStyle"],"sources":["../../../src/lib/series/VolumeProfileSeries.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport { ascending, descending, sum, max, merge, zip, histogram as d3Histogram } from \"d3-array\";\r\nimport { nest } from \"d3-collection\";\r\nimport { scaleLinear } from \"d3-scale\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport { head, last, hexToRGBA, accumulatingWindow, identity, functor } from \"../utils\";\r\n\r\nclass VolumeProfileSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst { xAccessor, width } = moreProps;\r\n\t\tconst { rects, sessionBg } = helper(this.props, moreProps, xAccessor, width);\r\n\r\n\t\tdrawOnCanvas(ctx, this.props, rects, sessionBg);\r\n\t}\r\n\trender() {\r\n\t\treturn <GenericChartComponent\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { className, opacity } = this.props;\r\n\t\tconst { showSessionBackground, sessionBackGround, sessionBackGroundOpacity } = this.props;\r\n\r\n\t\tconst { xAccessor, width } = moreProps;\r\n\t\tconst { rects, sessionBg } = helper(this.props, moreProps, xAccessor, width);\r\n\r\n\t\tconst sessionBgSvg = showSessionBackground\r\n\t\t\t? sessionBg.map((d, idx) => <rect key={idx} {...d} opacity={sessionBackGroundOpacity} fillRule={sessionBackGround} />)\r\n\t\t\t: null;\r\n\r\n\t\treturn <g className={className}>\r\n\t\t\t{sessionBgSvg}\r\n\t\t\t{rects.map((d, i) => <g key={i}>\r\n\t\t\t\t<rect x={d.x} y={d.y}\r\n\t\t\t\t\twidth={d.w1} height={d.height}\r\n\t\t\t\t\tfillRule={d.fill1} stroke={d.stroke1} fillOpacity={opacity} />\r\n\t\t\t\t<rect x={d.x + d.w1} y={d.y}\r\n\t\t\t\t\twidth={d.w2} height={d.height}\r\n\t\t\t\t\tfillRule={d.fill2} stroke={d.stroke2} fillOpacity={opacity} />\r\n\t\t\t</g>)}\r\n\t\t</g>;\r\n\t}\r\n}\r\n\r\nVolumeProfileSeries.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\topacity: PropTypes.number,\r\n\tshowSessionBackground: PropTypes.bool,\r\n\tsessionBackGround: PropTypes.string,\r\n\tsessionBackGroundOpacity: PropTypes.number,\r\n};\r\n\r\n\r\nVolumeProfileSeries.defaultProps = {\r\n\tclassName: \"line \",\r\n\tbins: 20,\r\n\topacity: 0.5,\r\n\tmaxProfileWidthPercent: 50,\r\n\tfill: ({ type }) => type === \"up\" ? \"#6BA583\" : \"#FF0000\",\r\n\tstroke: \"#FFFFFF\",\r\n\tshowSessionBackground: false,\r\n\tsessionBackGround: \"#4682B4\",\r\n\tsessionBackGroundOpacity: 0.3,\r\n\r\n\tsource: d => d.close,\r\n\tvolume: d => d.volume,\r\n\tabsoluteChange: d => d.absoluteChange,\r\n\tbySession: false,\r\n\t/* eslint-disable no-unused-vars */\r\n\tsessionStart: ({ d, i, plotData }) => i > 0 && plotData[i - 1].date.getMonth() !== d.date.getMonth(),\r\n\t/* eslint-enable no-unused-vars */\r\n\torient: \"left\",\r\n\t// // fill: ({ type }) => { var c = type === \"up\" ? \"#6BA583\" : \"#FF0000\"; console.log(type, c); return c },\r\n\t// stroke: ({ type }) =>  type === \"up\" ? \"#6BA583\" : \"#FF0000\",\r\n\t// stroke: \"none\",\r\n\tpartialStartOK: true,\r\n\tpartialEndOK: true,\r\n};\r\n\r\nfunction helper(props, moreProps, xAccessor, width) {\r\n\tconst { xScale: realXScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\tconst { sessionStart, bySession, partialStartOK, partialEndOK } = props;\r\n\tconst { bins, maxProfileWidthPercent, source, volume, absoluteChange, orient, fill, stroke } = props;\r\n\r\n\tconst sessionBuilder = accumulatingWindow()\r\n\t\t.discardTillStart(!partialStartOK)\r\n\t\t.discardTillEnd(!partialEndOK)\r\n\t\t.accumulateTill((d, i) => {\r\n\t\t\treturn sessionStart({ d, i, ...moreProps });\r\n\t\t})\r\n\t\t.accumulator(identity);\r\n\r\n\tconst dx = plotData.length > 1 ? realXScale(xAccessor(plotData[1])) - realXScale(xAccessor(head(plotData))) : 0;\r\n\r\n\tconst sessions = bySession ? sessionBuilder(plotData) : [plotData];\r\n\r\n\tconst allRects = sessions.map(session => {\r\n\r\n\t\tconst begin = bySession ? realXScale(xAccessor(head(session))) : 0;\r\n\t\tconst finish = bySession ? realXScale(xAccessor(last(session))) : width;\r\n\t\tconst sessionWidth = finish - begin + dx;\r\n\r\n\t\t// console.log(session)\r\n\r\n\t\t/* var histogram = d3.layout.histogram()\r\n\t\t\t\t.value(source)\r\n\t\t\t\t.bins(bins);*/\r\n\r\n\t\tconst histogram2 = d3Histogram()\r\n\t\t\t// .domain(xScale.domain())\r\n\t\t\t.value(source)\r\n\t\t\t.thresholds(bins);\r\n\r\n\t\t// console.log(bins, histogram(session))\r\n\t\t// console.log(bins, histogram2(session))\r\n\t\tconst rollup = nest()\r\n\t\t\t.key(d => d.direction)\r\n\t\t\t.sortKeys(orient === \"right\" ? descending : ascending)\r\n\t\t\t.rollup(leaves => sum(leaves, d => d.volume));\r\n\r\n\t\tconst values = histogram2(session);\r\n\t\t// console.log(\"values\", values)\r\n\r\n\t\tconst volumeInBins = values\r\n\t\t\t.map(arr => arr.map(d => absoluteChange(d) > 0 ? { direction: \"up\", volume: volume(d) } : { direction: \"down\", volume: volume(d) }))\r\n\t\t\t.map(arr => rollup.entries(arr));\r\n\r\n\t\t// console.log(\"volumeInBins\", volumeInBins)\r\n\t\tconst volumeValues = volumeInBins\r\n\t\t\t.map(each => sum(each.map(d => d.value)));\r\n\r\n\t\t// console.log(\"volumeValues\", volumeValues)\r\n\t\tconst base = xScale => head(xScale.range());\r\n\r\n\t\tconst [start, end] = orient === \"right\"\r\n\t\t\t? [begin, begin + sessionWidth * maxProfileWidthPercent / 100]\r\n\t\t\t: [finish, finish - sessionWidth * (100 - maxProfileWidthPercent) / 100];\r\n\r\n\t\tconst xScale = scaleLinear()\r\n\t\t\t.domain([0, max(volumeValues)])\r\n\t\t\t.range([start, end]);\r\n\r\n\t\t// console.log(xScale.domain())\r\n\r\n\t\tconst totalVolumes = volumeInBins.map(volumes => {\r\n\r\n\t\t\tconst totalVolume = sum(volumes, d => d.value);\r\n\t\t\tconst totalVolumeX = xScale(totalVolume);\r\n\t\t\tconst width = base(xScale) - totalVolumeX;\r\n\t\t\tconst x = width < 0 ? totalVolumeX + width : totalVolumeX;\r\n\r\n\t\t\tconst ws = volumes.map(d => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttype: d.key,\r\n\t\t\t\t\twidth: d.value * Math.abs(width) / totalVolume,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\treturn { x, ws, totalVolumeX };\r\n\t\t});\r\n\t\t// console.log(\"totalVolumes\", totalVolumes)\r\n\r\n\t\tconst rects = zip(values, totalVolumes)\r\n\t\t\t.map(([d, { x, ws }]) => {\r\n\t\t\t\tconst w1 = ws[0] || { type: \"up\", width: 0 };\r\n\t\t\t\tconst w2 = ws[1] || { type: \"down\", width: 0 };\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\t// y: yScale(d.x + d.dx),\r\n\t\t\t\t\ty: yScale(d.x1),\r\n\t\t\t\t\t// height: yScale(d.x - d.dx) - yScale(d.x),\r\n\t\t\t\t\theight: yScale(d.x1) - yScale(d.x0),\r\n\t\t\t\t\tx,\r\n\t\t\t\t\twidth,\r\n\t\t\t\t\tw1: w1.width,\r\n\t\t\t\t\tw2: w2.width,\r\n\t\t\t\t\tstroke1: functor(stroke)(w1),\r\n\t\t\t\t\tstroke2: functor(stroke)(w2),\r\n\t\t\t\t\tfill1: functor(fill)(w1),\r\n\t\t\t\t\tfill2: functor(fill)(w2),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t// console.log(\"rects\", rects)\r\n\r\n\t\tconst sessionBg = {\r\n\t\t\tx: begin,\r\n\t\t\ty: last(rects).y,\r\n\t\t\theight: head(rects).y - last(rects).y + head(rects).height,\r\n\t\t\twidth: sessionWidth,\r\n\t\t};\r\n\r\n\t\treturn { rects, sessionBg };\r\n\t});\r\n\r\n\treturn {\r\n\t\trects: merge(allRects.map(d => d.rects)),\r\n\t\tsessionBg: allRects.map(d => d.sessionBg),\r\n\t};\r\n}\r\n\r\n\r\nfunction drawOnCanvas(ctx, props, rects, sessionBg) {\r\n\tconst { opacity, sessionBackGround, sessionBackGroundOpacity, showSessionBackground } = props;\r\n\r\n\t// var { rects, sessionBg } = helper(props, xScale, yScale, plotData);\r\n\r\n\tif (showSessionBackground) {\r\n\t\tctx.fillStyle = hexToRGBA(sessionBackGround, sessionBackGroundOpacity);\r\n\r\n\t\tsessionBg.forEach(each => {\r\n\t\t\tconst { x, y, height, width } = each;\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.rect(x, y, width, height);\r\n\t\t\tctx.closePath();\r\n\t\t\tctx.fill();\r\n\t\t});\r\n\t}\r\n\r\n\trects.forEach(each => {\r\n\t\tconst { x, y, height, w1, w2, stroke1, stroke2, fill1, fill2 } = each;\r\n\r\n\r\n\t\tif (w1 > 0) {\r\n\t\t\tctx.fillStyle = hexToRGBA(fill1, opacity);\r\n\t\t\tif (stroke1 !== \"none\") ctx.strokeStyle = stroke1;\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.rect(x, y, w1, height);\r\n\t\t\tctx.closePath();\r\n\t\t\tctx.fill();\r\n\r\n\t\t\tif (stroke1 !== \"none\") ctx.stroke();\r\n\t\t}\r\n\r\n\t\tif (w2 > 0) {\r\n\t\t\tctx.fillStyle = hexToRGBA(fill2, opacity);\r\n\t\t\tif (stroke2 !== \"none\") ctx.strokeStyle = stroke2;\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.rect(x + w1, y, w2, height);\r\n\t\t\tctx.closePath();\r\n\t\t\tctx.fill();\r\n\r\n\t\t\tif (stroke2 !== \"none\") ctx.stroke();\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\nexport default VolumeProfileSeries;\r\n"],"mappings":"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"}