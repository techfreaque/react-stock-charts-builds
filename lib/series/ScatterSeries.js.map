{"version":3,"file":"ScatterSeries.js","names":["ScatterSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","points","helper","className","markerProps","map","point","idx","Marker","marker","getAxisCanvas","Component","propTypes","PropTypes","string","yAccessor","func","isRequired","markerProvider","object","defaultProps","xScale","yScale","chartConfig","plotData","Error","d","mProps","fill","functor","stroke","x","y","hexToRGBA","opacity","datum","nest","d3Nest","key","entries","forEach","fillGroup","fillKey","fillValues","values","fillStyle","strokeGroup","strokeValues"],"sources":["../../../src/lib/series/ScatterSeries.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { nest as d3Nest } from \"d3-collection\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport { hexToRGBA, functor } from \"../utils\";\r\n\r\nclass ScatterSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\r\n\t\tconst points = helper(this.props, moreProps, xAccessor);\r\n\r\n\t\tdrawOnCanvas(ctx, this.props, points);\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { className, markerProps } = this.props;\r\n\t\tconst { xAccessor } = moreProps;\r\n\r\n\t\tconst points = helper(this.props, moreProps, xAccessor);\r\n\r\n\t\treturn <g className={className}>\r\n\t\t\t{points.map((point, idx) => {\r\n\t\t\t\tconst { marker: Marker } = point;\r\n\t\t\t\treturn <Marker key={idx} {...markerProps} point={point} />;\r\n\t\t\t})}\r\n\t\t</g>;\r\n\t}\r\n\trender() {\r\n\t\treturn <GenericChartComponent\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nScatterSeries.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\tyAccessor: PropTypes.func.isRequired,\r\n\tmarker: PropTypes.func,\r\n\tmarkerProvider: PropTypes.func,\r\n\tmarkerProps: PropTypes.object,\r\n};\r\n\r\nScatterSeries.defaultProps = {\r\n\tclassName: \"react-stockcharts-scatter\",\r\n};\r\n\r\nfunction helper(props, moreProps, xAccessor) {\r\n\tconst { yAccessor, markerProvider, markerProps } = props;\r\n\tlet { marker: Marker } = props;\r\n\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\tif (!(markerProvider || Marker)) throw new Error(\"required prop, either marker or markerProvider missing\");\r\n\r\n\treturn plotData.map(d => {\r\n\r\n\t\tif (markerProvider) Marker = markerProvider(d);\r\n\r\n\t\tconst mProps = { ...Marker.defaultProps, ...markerProps };\r\n\r\n\t\tconst fill = functor(mProps.fill);\r\n\t\tconst stroke = functor(mProps.stroke);\r\n\r\n\t\treturn {\r\n\t\t\tx: xScale(xAccessor(d)),\r\n\t\t\ty: yScale(yAccessor(d)),\r\n\t\t\tfill: hexToRGBA(fill(d), mProps.opacity),\r\n\t\t\tstroke: stroke(d),\r\n\t\t\tdatum: d,\r\n\t\t\tmarker: Marker,\r\n\t\t};\r\n\t});\r\n}\r\n\r\nfunction drawOnCanvas(ctx, props, points) {\r\n\r\n\tconst { markerProps } = props;\r\n\r\n\tconst nest = d3Nest()\r\n\t\t.key(d => d.fill)\r\n\t\t.key(d => d.stroke)\r\n\t\t.entries(points);\r\n\r\n\tnest.forEach(fillGroup => {\r\n\t\tconst { key: fillKey, values: fillValues } = fillGroup;\r\n\r\n\t\tif (fillKey !== \"none\") {\r\n\t\t\tctx.fillStyle = fillKey;\r\n\t\t}\r\n\r\n\t\tfillValues.forEach(strokeGroup => {\r\n\t\t\t// var { key: strokeKey, values: strokeValues } = strokeGroup;\r\n\t\t\tconst { values: strokeValues } = strokeGroup;\r\n\r\n\t\t\tstrokeValues.forEach(point => {\r\n\t\t\t\tconst { marker } = point;\r\n\t\t\t\tmarker.drawOnCanvas({ ...marker.defaultProps, ...markerProps, fill: fillKey }, point, ctx);\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport default ScatterSeries;\r\n"],"mappings":"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"}