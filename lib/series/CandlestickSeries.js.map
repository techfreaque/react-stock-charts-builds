{"version":3,"file":"CandlestickSeries.js","names":["CandlestickSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","className","wickClassName","candleClassName","xScale","yScale","chartConfig","plotData","xAccessor","candleData","getCandleData","getWicksSVG","getCandlesSVG","clip","getAxisCanvas","Component","propTypes","PropTypes","string","widthRatio","number","width","oneOfType","func","classNames","fill","stroke","wickStroke","yAccessor","bool","defaultProps","d","open","high","low","close","plotDataLengthBarWidth","candleStrokeWidth","opacity","wicks","map","each","idx","wick","x","y1","y2","y3","y4","candles","y","height","wickNest","nest","key","entries","forEach","outer","values","strokeStyle","fillStyle","fillRect","candleNest","strokeKey","strokeValues","lineWidth","inner","head","hexToRGBA","strokeRect","wickStrokeProp","functor","fillProp","strokeProp","widthFunctor","trueOffset","offset","Math","round","floor","i","length","isDefined","ohlc","max","abs","push","direction"],"sources":["../../../src/lib/series/CandlestickSeries.js"],"sourcesContent":["\r\n\r\nimport { nest } from \"d3-collection\";\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport {\r\n\thexToRGBA, isDefined, functor, plotDataLengthBarWidth, head\r\n} from \"../utils\";\r\n\r\nclass CandlestickSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tdrawOnCanvas(ctx, this.props, moreProps);\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { className, wickClassName, candleClassName } = this.props;\r\n\t\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\r\n\r\n\t\tconst candleData = getCandleData(this.props, xAccessor, xScale, yScale, plotData);\r\n\r\n\t\treturn <g className={className}>\r\n\t\t\t<g className={wickClassName} key=\"wicks\">\r\n\t\t\t\t{getWicksSVG(candleData)}\r\n\t\t\t</g>\r\n\t\t\t<g className={candleClassName} key=\"candles\">\r\n\t\t\t\t{getCandlesSVG(this.props, candleData)}\r\n\t\t\t</g>\r\n\t\t</g>;\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { clip } = this.props;\r\n\t\treturn <GenericChartComponent\r\n\t\t\tclip={clip}\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nCandlestickSeries.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\twickClassName: PropTypes.string,\r\n\tcandleClassName: PropTypes.string,\r\n\twidthRatio: PropTypes.number,\r\n\twidth: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func\r\n\t]),\r\n\tclassNames: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]),\r\n\tfill: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]),\r\n\tstroke: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]),\r\n\twickStroke: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]),\r\n\tyAccessor: PropTypes.func,\r\n\tclip: PropTypes.bool,\r\n};\r\n\r\nCandlestickSeries.defaultProps = {\r\n\tclassName: \"react-stockcharts-candlestick\",\r\n\twickClassName: \"react-stockcharts-candlestick-wick\",\r\n\tcandleClassName: \"react-stockcharts-candlestick-candle\",\r\n\tyAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\r\n\tclassNames: d => d.close > d.open ? \"up\" : \"down\",\r\n\twidth: plotDataLengthBarWidth,\r\n\twickStroke: \"#000000\",\r\n\t// wickStroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\r\n\tfill: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\r\n\t// stroke: d => d.close > d.open ? \"#6BA583\" : \"#FF0000\",\r\n\tstroke: \"#000000\",\r\n\tcandleStrokeWidth: 0.5,\r\n\t// stroke: \"none\",\r\n\twidthRatio: 0.8,\r\n\topacity: 0.5,\r\n\tclip: true,\r\n};\r\n\r\nfunction getWicksSVG(candleData) {\r\n\r\n\tconst wicks = candleData\r\n\t\t.map((each, idx) => {\r\n\t\t\tconst d = each.wick;\r\n\t\t\treturn <path key={idx}\r\n\t\t\t\tclassName={each.className}\r\n\t\t\t\tstroke={d.stroke}\r\n\t\t\t\td={`M${d.x},${d.y1} L${d.x},${d.y2} M${d.x},${d.y3} L${d.x},${d.y4}`} />;\r\n\t\t});\r\n\r\n\treturn wicks;\r\n}\r\n\r\nfunction getCandlesSVG(props, candleData) {\r\n\r\n\t/* eslint-disable react/prop-types */\r\n\tconst { opacity, candleStrokeWidth } = props;\r\n\t/* eslint-enable react/prop-types */\r\n\r\n\tconst candles = candleData.map((d, idx) => {\r\n\t\tif (d.width <= 1)\r\n\t\t\treturn (\r\n\t\t\t\t<line className={d.className} key={idx}\r\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}\r\n\t\t\t\t\tstroke={d.fill} />\r\n\t\t\t);\r\n\t\telse if (d.height === 0)\r\n\t\t\treturn (\r\n\t\t\t\t<line key={idx}\r\n\t\t\t\t\tx1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height}\r\n\t\t\t\t\tstroke={d.fill} />\r\n\t\t\t);\r\n\t\treturn (\r\n\t\t\t<rect key={idx} className={d.className}\r\n\t\t\t\tfillOpacity={opacity}\r\n\t\t\t\tx={d.x} y={d.y} width={d.width} height={d.height}\r\n\t\t\t\tfill={d.fill} stroke={d.stroke} strokeWidth={candleStrokeWidth} />\r\n\t\t);\r\n\t});\r\n\treturn candles;\r\n}\r\n\r\nfunction drawOnCanvas(ctx, props, moreProps) {\r\n\tconst { opacity, candleStrokeWidth } = props;\r\n\tconst { xScale, chartConfig: { yScale }, plotData, xAccessor } = moreProps;\r\n\r\n\t// const wickData = getWickData(props, xAccessor, xScale, yScale, plotData);\r\n\tconst candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\r\n\r\n\tconst wickNest = nest()\r\n\t\t.key(d => d.wick.stroke)\r\n\t\t.entries(candleData);\r\n\r\n\twickNest.forEach(outer => {\r\n\t\tconst { key, values } = outer;\r\n\t\tctx.strokeStyle = key;\r\n\t\tctx.fillStyle = key;\r\n\t\tvalues.forEach(each => {\r\n\t\t\t/*\r\n\t\t\tctx.moveTo(d.x, d.y1);\r\n\t\t\tctx.lineTo(d.x, d.y2);\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(d.x, d.y3);\r\n\t\t\tctx.lineTo(d.x, d.y4);\r\n\t\t\tctx.stroke(); */\r\n\t\t\tconst d = each.wick;\r\n\r\n\t\t\tctx.fillRect(d.x - 0.5, d.y1, 1, d.y2 - d.y1);\r\n\t\t\tctx.fillRect(d.x - 0.5, d.y3, 1, d.y4 - d.y3);\r\n\t\t});\r\n\t});\r\n\r\n\t// const candleData = getCandleData(props, xAccessor, xScale, yScale, plotData);\r\n\r\n\tconst candleNest = nest()\r\n\t\t.key(d => d.stroke)\r\n\t\t.key(d => d.fill)\r\n\t\t.entries(candleData);\r\n\r\n\r\n\tcandleNest.forEach(outer => {\r\n\t\tconst { key: strokeKey, values: strokeValues } = outer;\r\n\t\tif (strokeKey !== \"none\") {\r\n\t\t\tctx.strokeStyle = strokeKey;\r\n\t\t\tctx.lineWidth = candleStrokeWidth;\r\n\t\t}\r\n\t\tstrokeValues.forEach(inner => {\r\n\t\t\tconst { key, values } = inner;\r\n\t\t\tconst fillStyle = head(values).width <= 1\r\n\t\t\t\t? key\r\n\t\t\t\t: hexToRGBA(key, opacity);\r\n\t\t\tctx.fillStyle = fillStyle;\r\n\r\n\t\t\tvalues.forEach(d => {\r\n\t\t\t\tif (d.width <= 1) {\r\n\t\t\t\t\t// <line className={d.className} key={idx} x1={d.x} y1={d.y} x2={d.x} y2={d.y + d.height}/>\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(d.x, d.y);\r\n\t\t\t\t\tctx.lineTo(d.x, d.y + d.height);\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tctx.fillRect(d.x - 0.5, d.y, 1, d.height);\r\n\t\t\t\t} else if (d.height === 0) {\r\n\t\t\t\t\t// <line key={idx} x1={d.x} y1={d.y} x2={d.x + d.width} y2={d.y + d.height} />\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(d.x, d.y);\r\n\t\t\t\t\tctx.lineTo(d.x + d.width, d.y + d.height);\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tctx.fillRect(d.x, d.y - 0.5, d.width, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.rect(d.x, d.y, d.width, d.height);\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\tctx.fill();\r\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.stroke();\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tctx.fillRect(d.x, d.y, d.width, d.height);\r\n\t\t\t\t\tif (strokeKey !== \"none\") ctx.strokeRect(d.x, d.y, d.width, d.height);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n}\r\n/*\r\nfunction getWickData(props, xAccessor, xScale, yScale, plotData) {\r\n\r\n\tconst { classNames: classNameProp, wickStroke: wickStrokeProp, yAccessor } = props;\r\n\tconst wickStroke = functor(wickStrokeProp);\r\n\tconst className = functor(classNameProp);\r\n\tconst wickData = plotData\r\n\t\t\t.filter(d => isDefined(yAccessor(d).close))\r\n\t\t\t.map(d => {\r\n\t\t\t\t// console.log(yAccessor);\r\n\t\t\t\tconst ohlc = yAccessor(d);\r\n\r\n\t\t\t\tconst x = Math.round(xScale(xAccessor(d))),\r\n\t\t\t\t\ty1 = yScale(ohlc.high),\r\n\t\t\t\t\ty2 = yScale(Math.max(ohlc.open, ohlc.close)),\r\n\t\t\t\t\ty3 = yScale(Math.min(ohlc.open, ohlc.close)),\r\n\t\t\t\t\ty4 = yScale(ohlc.low);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx,\r\n\t\t\t\t\ty1,\r\n\t\t\t\t\ty2,\r\n\t\t\t\t\ty3,\r\n\t\t\t\t\ty4,\r\n\t\t\t\t\tclassName: className(ohlc),\r\n\t\t\t\t\tdirection: (ohlc.close - ohlc.open),\r\n\t\t\t\t\tstroke: wickStroke(ohlc),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\treturn wickData;\r\n}\r\n*/\r\n\r\nfunction getCandleData(props, xAccessor, xScale, yScale, plotData) {\r\n\r\n\tconst { wickStroke: wickStrokeProp } = props;\r\n\tconst wickStroke = functor(wickStrokeProp);\r\n\r\n\tconst { classNames, fill: fillProp, stroke: strokeProp, yAccessor } = props;\r\n\tconst className = functor(classNames);\r\n\r\n\tconst fill = functor(fillProp);\r\n\tconst stroke = functor(strokeProp);\r\n\r\n\tconst widthFunctor = functor(props.width);\r\n\tconst width = widthFunctor(props, {\r\n\t\txScale,\r\n\t\txAccessor,\r\n\t\tplotData\r\n\t});\r\n\r\n\t/*\r\n\tconst candleWidth = Math.round(width);\r\n\tconst offset = Math.round(candleWidth === 1 ? 0 : 0.5 * width);\r\n\t*/\r\n\tconst trueOffset = 0.5 * width;\r\n\tconst offset = trueOffset > 0.7\r\n\t\t? Math.round(trueOffset)\r\n\t\t: Math.floor(trueOffset);\r\n\r\n\t// eslint-disable-next-line prefer-const\r\n\tlet candles = [];\r\n\r\n\tfor (let i = 0; i < plotData.length; i++) {\r\n\t\tconst d = plotData[i];\r\n\t\tif (isDefined(yAccessor(d).close)) {\r\n\t\t\tconst x = Math.round(xScale(xAccessor(d)));\r\n\t\t\t// const x = Math.round(xScale(xAccessor(d)) - offset);\r\n\r\n\t\t\tconst ohlc = yAccessor(d);\r\n\t\t\tconst y = Math.round(yScale(Math.max(ohlc.open, ohlc.close)));\r\n\t\t\tconst height = Math.round(Math.abs(yScale(ohlc.open) - yScale(ohlc.close)));\r\n\r\n\t\t\tcandles.push({\r\n\t\t\t\t// type: \"line\"\r\n\t\t\t\tx: x - offset,\r\n\t\t\t\ty: y,\r\n\t\t\t\twick: {\r\n\t\t\t\t\tstroke: wickStroke(ohlc),\r\n\t\t\t\t\tx: x,\r\n\t\t\t\t\ty1: Math.round(yScale(ohlc.high)),\r\n\t\t\t\t\ty2: y,\r\n\t\t\t\t\ty3: y + height, // Math.round(yScale(Math.min(ohlc.open, ohlc.close))),\r\n\t\t\t\t\ty4: Math.round(yScale(ohlc.low)),\r\n\t\t\t\t},\r\n\t\t\t\theight: height,\r\n\t\t\t\twidth: offset * 2,\r\n\t\t\t\tclassName: className(ohlc),\r\n\t\t\t\tfill: fill(ohlc),\r\n\t\t\t\tstroke: stroke(ohlc),\r\n\t\t\t\tdirection: (ohlc.close - ohlc.open),\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\treturn candles;\r\n}\r\n\r\nexport default CandlestickSeries;\r\n"],"mappings":"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"}