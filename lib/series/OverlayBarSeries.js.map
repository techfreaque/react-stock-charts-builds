{"version":3,"file":"OverlayBarSeries.js","names":["OverlayBarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","yAccessor","bars","getBars","drawOnCanvas2","getBarsSVG2","clip","getAxisCanvas","Component","propTypes","baseAt","PropTypes","oneOfType","number","func","isRequired","direction","oneOf","stroke","bool","widthRatio","opacity","fill","string","className","xAccessor","arrayOf","xScale","yScale","plotData","array","defaultProps","first","range","width","plotDataLengthBarWidth","chartConfig","getClassName","functor","getFill","getBase","widthFunctor","offset","Math","floor","map","d","innerBars","eachYAccessor","i","yValue","isNotDefined","undefined","xValue","x","round","y","filter","isDefined","b","h","length","height","merge"],"sources":["../../../src/lib/series/OverlayBarSeries.js"],"sourcesContent":["\r\n\r\nimport { merge } from \"d3-array\";\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport { drawOnCanvas2, getBarsSVG2 } from \"./StackedBarSeries\";\r\nimport { isDefined, isNotDefined, first, functor, plotDataLengthBarWidth } from \"../utils\";\r\n\r\nclass OverlayBarSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst { yAccessor } = this.props;\r\n\t\tconst bars = getBars(this.props, moreProps, yAccessor);\r\n\r\n\t\tdrawOnCanvas2(this.props, ctx, bars);\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { yAccessor } = this.props;\r\n\r\n\t\tconst bars = getBars(this.props, moreProps, yAccessor);\r\n\t\treturn <g className=\"react-stockcharts-bar-series\">\r\n\t\t\t{getBarsSVG2(this.props, bars)}\r\n\t\t</g>;\r\n\t}\r\n\trender() {\r\n\t\tconst { clip } = this.props;\r\n\r\n\t\treturn <GenericChartComponent\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tclip={clip}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n}\r\n\r\nOverlayBarSeries.propTypes = {\r\n\tbaseAt: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func,\r\n\t]).isRequired,\r\n\tdirection: PropTypes.oneOf([\"up\", \"down\"]).isRequired,\r\n\tstroke: PropTypes.bool.isRequired,\r\n\twidthRatio: PropTypes.number.isRequired,\r\n\topacity: PropTypes.number.isRequired,\r\n\tfill: PropTypes.oneOfType([\r\n\t\tPropTypes.func, PropTypes.string\r\n\t]).isRequired,\r\n\tclassName: PropTypes.oneOfType([\r\n\t\tPropTypes.func, PropTypes.string\r\n\t]).isRequired,\r\n\txAccessor: PropTypes.func,\r\n\tyAccessor: PropTypes.arrayOf(PropTypes.func),\r\n\txScale: PropTypes.func,\r\n\tyScale: PropTypes.func,\r\n\tplotData: PropTypes.array,\r\n\tclip: PropTypes.bool.isRequired,\r\n};\r\n\r\nOverlayBarSeries.defaultProps = {\r\n\tbaseAt: (xScale, yScale/* , d*/) => first(yScale.range()),\r\n\tdirection: \"up\",\r\n\tclassName: \"bar\",\r\n\tstroke: false,\r\n\tfill: \"#4682B4\",\r\n\topacity: 1,\r\n\twidthRatio: 0.5,\r\n\twidth: plotDataLengthBarWidth,\r\n\tclip: true,\r\n};\r\n\r\nfunction getBars(props, moreProps, yAccessor) {\r\n\tconst { xScale, xAccessor, chartConfig: { yScale }, plotData } = moreProps;\r\n\tconst { baseAt, className, fill, stroke } = props;\r\n\r\n\tconst getClassName = functor(className);\r\n\tconst getFill = functor(fill);\r\n\tconst getBase = functor(baseAt);\r\n\tconst widthFunctor = functor(props.width);\r\n\r\n\tconst width = widthFunctor(props, moreProps);\r\n\tconst offset = Math.floor(0.5 * width);\r\n\r\n\t// console.log(xScale.domain(), yScale.domain());\r\n\r\n\tconst bars = plotData\r\n\t\t.map(d => {\r\n\t\t\t// eslint-disable-next-line prefer-const\r\n\t\t\tlet innerBars = yAccessor.map((eachYAccessor, i) => {\r\n\t\t\t\tconst yValue = eachYAccessor(d);\r\n\t\t\t\tif (isNotDefined(yValue)) return undefined;\r\n\r\n\t\t\t\tconst xValue = xAccessor(d);\r\n\t\t\t\tconst x = Math.round(xScale(xValue)) - offset;\r\n\t\t\t\tconst y = yScale(yValue);\r\n\t\t\t\t// console.log(yValue, y, xValue, x)\r\n\t\t\t\treturn {\r\n\t\t\t\t\twidth: offset * 2,\r\n\t\t\t\t\tx: x,\r\n\t\t\t\t\ty: y,\r\n\t\t\t\t\tclassName: getClassName(d, i),\r\n\t\t\t\t\tstroke: stroke ? getFill(d, i) : \"none\",\r\n\t\t\t\t\tfill: getFill(d, i),\r\n\t\t\t\t\ti,\r\n\t\t\t\t};\r\n\t\t\t}).filter(yValue => isDefined(yValue));\r\n\r\n\t\t\tlet b = getBase(xScale, yScale, d);\r\n\t\t\tlet h;\r\n\t\t\tfor (let i = innerBars.length - 1; i >= 0; i--) {\r\n\t\t\t\th = b - innerBars[i].y;\r\n\t\t\t\tif (h < 0) {\r\n\t\t\t\t\tinnerBars[i].y = b;\r\n\t\t\t\t\th = -1 * h;\r\n\t\t\t\t}\r\n\t\t\t\tinnerBars[i].height = h;\r\n\t\t\t\tb = innerBars[i].y;\r\n\t\t\t}\r\n\t\t\treturn innerBars;\r\n\t\t});\r\n\r\n\treturn merge(bars);\r\n}\r\n\r\nexport default OverlayBarSeries;\r\n"],"mappings":"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"}