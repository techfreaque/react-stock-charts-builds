{"version":3,"file":"OHLCSeries.js","names":["OHLCSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","yAccessor","xAccessor","xScale","yScale","chartConfig","plotData","barData","getOHLCBars","clip","getAxisCanvas","className","strokeWidth","bars","map","d","idx","stroke","openX1","openY","openX2","x","y1","y2","closeX1","closeY","closeX2","Component","propTypes","PropTypes","string","classNames","oneOfType","func","isRequired","bool","defaultProps","open","high","low","close","isDefined","absoluteChange","wickNest","nest","key","entries","lineWidth","forEach","outer","values","strokeStyle","beginPath","moveTo","lineTo","classNamesProp","strokeProp","strokeFunc","functor","classNameFunc","width","length","barWidth","Math","max","round","min","filter","ohlc"],"sources":["../../../src/lib/series/OHLCSeries.js"],"sourcesContent":["\r\n\r\nimport { nest } from \"d3-collection\";\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport { isDefined, functor } from \"../utils\";\r\n\r\nclass OHLCSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst { yAccessor } = this.props;\r\n\t\tconst { xAccessor } = moreProps;\r\n\t\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\t\tconst barData = getOHLCBars(this.props, xAccessor, yAccessor, xScale, yScale, plotData);\r\n\t\tdrawOnCanvas(ctx, barData);\r\n\t}\r\n\trender() {\r\n\t\tconst { clip } = this.props;\r\n\r\n\t\treturn <GenericChartComponent\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tclip={clip}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { className, yAccessor } = this.props;\r\n\t\tconst { xAccessor } = moreProps;\r\n\t\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\r\n\t\tconst barData = getOHLCBars(this.props, xAccessor, yAccessor, xScale, yScale, plotData);\r\n\r\n\t\tconst { strokeWidth, bars } = barData;\r\n\r\n\t\treturn <g className={className}>\r\n\t\t\t{bars.map((d, idx) => <path key={idx}\r\n\t\t\t\tclassName={d.className} stroke={d.stroke} strokeWidth={strokeWidth}\r\n\t\t\t\td={`M${d.openX1} ${d.openY} L${d.openX2} ${d.openY} M${d.x} ${d.y1} L${d.x} ${d.y2} M${d.closeX1} ${d.closeY} L${d.closeX2} ${d.closeY}`}/>)}\r\n\t\t</g>;\r\n\t}\r\n}\r\n\r\nOHLCSeries.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\tclassNames: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]).isRequired,\r\n\tstroke: PropTypes.oneOfType([\r\n\t\tPropTypes.func,\r\n\t\tPropTypes.string\r\n\t]).isRequired,\r\n\tyAccessor: PropTypes.func.isRequired,\r\n\tclip: PropTypes.bool.isRequired,\r\n};\r\n\r\nOHLCSeries.defaultProps = {\r\n\tclassName: \"react-stockcharts-ohlc\",\r\n\tyAccessor: (d) => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\r\n\tclassNames: d => isDefined(d.absoluteChange) ? (d.absoluteChange > 0 ? \"up\" : \"down\") : \"firstbar\",\r\n\tstroke: d => isDefined(d.absoluteChange) ? (d.absoluteChange > 0 ? \"#6BA583\" : \"#FF0000\") : \"#000000\",\r\n\tclip: true,\r\n};\r\n\r\nfunction drawOnCanvas(ctx, barData) {\r\n\r\n\tconst { strokeWidth, bars } = barData;\r\n\r\n\tconst wickNest = nest()\r\n\t\t.key(d => d.stroke)\r\n\t\t.entries(bars);\r\n\r\n\tctx.lineWidth = strokeWidth;\r\n\r\n\twickNest.forEach(outer => {\r\n\t\tconst { key, values } = outer;\r\n\t\tctx.strokeStyle = key;\r\n\t\tvalues.forEach(d => {\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(d.x, d.y1);\r\n\t\t\tctx.lineTo(d.x, d.y2);\r\n\r\n\t\t\tctx.moveTo(d.openX1, d.openY);\r\n\t\t\tctx.lineTo(d.openX2, d.openY);\r\n\r\n\t\t\tctx.moveTo(d.closeX1, d.closeY);\r\n\t\t\tctx.lineTo(d.closeX2, d.closeY);\r\n\r\n\t\t\tctx.stroke();\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction getOHLCBars(props, xAccessor, yAccessor, xScale, yScale, plotData) {\r\n\tconst { classNames: classNamesProp, stroke: strokeProp } = props;\r\n\r\n\tconst strokeFunc = functor(strokeProp);\r\n\tconst classNameFunc = functor(classNamesProp);\r\n\r\n\tconst width = xScale(xAccessor(plotData[plotData.length - 1]))\r\n\t\t- xScale(xAccessor(plotData[0]));\r\n\r\n\tconst barWidth = Math.max(1, Math.round(width / (plotData.length - 1) / 2) - 1.5);\r\n\tconst strokeWidth = Math.min(barWidth, 6);\r\n\r\n\tconst bars = plotData\r\n\t\t.filter(d => isDefined(yAccessor(d).close))\r\n\t\t.map(d => {\r\n\t\t\tconst ohlc = yAccessor(d),\r\n\t\t\t\tx = Math.round(xScale(xAccessor(d))),\r\n\t\t\t\ty1 = yScale(ohlc.high),\r\n\t\t\t\ty2 = yScale(ohlc.low),\r\n\t\t\t\topenX1 = x - barWidth,\r\n\t\t\t\topenX2 = x + strokeWidth / 2,\r\n\t\t\t\topenY = yScale(ohlc.open),\r\n\t\t\t\tcloseX1 = x - strokeWidth / 2,\r\n\t\t\t\tcloseX2 = x + barWidth,\r\n\t\t\t\tcloseY = yScale(ohlc.close),\r\n\t\t\t\tclassName = classNameFunc(d),\r\n\t\t\t\tstroke = strokeFunc(d);\r\n\r\n\t\t\treturn { x, y1, y2, openX1, openX2, openY, closeX1, closeX2, closeY, stroke, className };\r\n\t\t});\r\n\treturn { barWidth, strokeWidth, bars };\r\n}\r\n\r\nexport default OHLCSeries;\r\n"],"mappings":"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"}