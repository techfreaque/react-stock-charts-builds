{"version":3,"file":"BarSeries.js","names":["BarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","swapScales","xAccessor","drawOnCanvasHelper","identityStack","bars","getBars","drawOnCanvas2","svgHelper","getBarsSVG2","clip","getAxisCanvas","Component","propTypes","baseAt","PropTypes","oneOfType","number","func","stroke","bool","width","yAccessor","isRequired","opacity","fill","string","className","defaultProps","StackedBarSeries","xScale","plotData","yScale","chartConfig","getFill","functor","getBase","widthFunctor","offset","Math","floor","filter","d","isDefined","map","yValue","y","x","round","h","height"],"sources":["../../../src/lib/series/BarSeries.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport StackedBarSeries, {\r\n\tdrawOnCanvasHelper,\r\n\tdrawOnCanvas2,\r\n\tgetBarsSVG2,\r\n\tsvgHelper,\r\n\tidentityStack\r\n} from \"./StackedBarSeries\";\r\n\r\nimport { functor, isDefined } from \"../utils\";\r\n\r\nclass BarSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tif (this.props.swapScales) {\r\n\t\t\tconst { xAccessor } = moreProps;\r\n\t\t\tdrawOnCanvasHelper(ctx, this.props, moreProps, xAccessor, identityStack);\r\n\t\t} else {\r\n\t\t\tconst bars = getBars(this.props, moreProps);\r\n\t\t\tdrawOnCanvas2(this.props, ctx, bars);\r\n\t\t}\r\n\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tif (this.props.swapScales) {\r\n\t\t\tconst { xAccessor } = moreProps;\r\n\t\t\treturn <g>{svgHelper(this.props, moreProps, xAccessor, identityStack)}</g>;\r\n\t\t} else {\r\n\t\t\tconst bars = getBars(this.props, moreProps);\r\n\t\t\treturn <g>{getBarsSVG2(this.props, bars)}</g>;\r\n\t\t}\r\n\r\n\t}\r\n\trender() {\r\n\t\tconst { clip } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<GenericChartComponent\r\n\t\t\t\tclip={clip}\r\n\t\t\t\tsvgDraw={this.renderSVG}\r\n\r\n\t\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\r\n\t\t\t\tdrawOn={[\"pan\"]}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nBarSeries.propTypes = {\r\n\tbaseAt: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func,\r\n\t]),\r\n\tstroke: PropTypes.bool,\r\n\twidth: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func\r\n\t]),\r\n\tyAccessor: PropTypes.func.isRequired,\r\n\topacity: PropTypes.number,\r\n\tfill: PropTypes.oneOfType([\r\n\t\tPropTypes.func, PropTypes.string\r\n\t]),\r\n\tclassName: PropTypes.oneOfType([\r\n\t\tPropTypes.func, PropTypes.string\r\n\t]),\r\n\tclip: PropTypes.bool,\r\n\tswapScales: PropTypes.bool,\r\n};\r\n\r\n\r\nBarSeries.defaultProps = StackedBarSeries.defaultProps;\r\n\r\nexport default BarSeries;\r\n\r\n/*\r\n Initially, this program was using StackedBarSeries.getBars\r\n to benefit from code reuse and having a single place that\r\n contains the logic for drawing all types of bar charts\r\n simple, grouped, horizontal, but turnes out\r\n making it highly cuztimizable also made it slow for the\r\n most simple case, a regular bar chart.\r\n This function contains just the necessary logic\r\n to create bars\r\n*/\r\nfunction getBars(props, moreProps) {\r\n\tconst { baseAt, fill, stroke, yAccessor } = props;\r\n\tconst { xScale, xAccessor, plotData, chartConfig: { yScale } } = moreProps;\r\n\r\n\tconst getFill = functor(fill);\r\n\tconst getBase = functor(baseAt);\r\n\r\n\tconst widthFunctor = functor(props.width);\r\n\r\n\tconst width = widthFunctor(props, {\r\n\t\txScale,\r\n\t\txAccessor,\r\n\t\tplotData\r\n\t});\r\n\t/*\r\n\tconst barWidth = Math.round(width);\r\n\tconst offset = Math.round(barWidth === 1 ? 0 : 0.5 * barWidth);\r\n\t*/\r\n\tconst offset = Math.floor(0.5 * width);\r\n\r\n\tconst bars = plotData\r\n\t\t.filter(d => isDefined(yAccessor(d)))\r\n\t\t.map(d => {\r\n\t\t\tconst yValue = yAccessor(d);\r\n\t\t\tlet y = yScale(yValue);\r\n\r\n\t\t\tconst x = Math.round(xScale(xAccessor(d))) - offset;\r\n\t\t\tlet h = getBase(xScale, yScale, d) - yScale(yValue);\r\n\r\n\t\t\tif (h < 0) {\r\n\t\t\t\ty = y + h;\r\n\t\t\t\th = -h;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\t// type: \"line\"\r\n\t\t\t\tx,\r\n\t\t\t\ty: Math.round(y),\r\n\t\t\t\theight: Math.round(h),\r\n\t\t\t\twidth: offset * 2,\r\n\t\t\t\tfill: getFill(d, 0),\r\n\t\t\t\tstroke: stroke ? getFill(d, 0) : \"none\",\r\n\t\t\t};\r\n\t\t});\r\n\r\n\treturn bars;\r\n}\r\n"],"mappings":"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"}