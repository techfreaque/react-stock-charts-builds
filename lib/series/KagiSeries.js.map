{"version":3,"file":"KagiSeries.js","names":["KagiSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","getAxisCanvas","xScale","yScale","chartConfig","plotData","className","stroke","fill","strokeWidth","paths","helper","map","each","i","dataSeries","line","x","item","y","curve","curveStepBefore","plot","type","Component","propTypes","PropTypes","string","object","number","isRequired","defaultProps","yang","yin","currentValueStroke","begin","forEach","strokeStyle","lineWidth","beginPath","prevX","d","moveTo","isDefined","lineTo","lastPlot","length","last","y1","y2","kagiLine","kagi","idx","isNotDefined","close","startAs","push","open","changeTo","changePoint","added","current","reverseAt"],"sources":["../../../src/lib/series/KagiSeries.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { line, curveStepBefore } from \"d3-shape\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\nimport { isDefined, isNotDefined } from \"../utils\";\r\n\r\nclass KagiSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\r\n\t\tdrawOnCanvas(ctx, this.props, moreProps, xAccessor);\r\n\t}\r\n\trender() {\r\n\t\treturn <GenericChartComponent\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\t\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\t\tconst { className, stroke, fill, strokeWidth } = this.props;\r\n\r\n\t\tconst paths = helper(plotData, xAccessor).map((each, i) => {\r\n\t\t\tconst dataSeries = line()\r\n\t\t\t\t.x((item) => xScale(item[0]))\r\n\t\t\t\t.y((item) => yScale(item[1]))\r\n\t\t\t\t.curve(curveStepBefore);\r\n\r\n\t\t\tdataSeries(each.plot);\r\n\r\n\t\t\treturn (<path key={i} d={dataSeries(each.plot)} className={each.type}\r\n\t\t\t\tstroke={stroke[each.type]} fill={fill[each.type]} strokeWidth={strokeWidth} />);\r\n\t\t});\r\n\t\treturn (\r\n\t\t\t<g className={className}>\r\n\t\t\t\t{paths}\r\n\t\t\t</g>\r\n\t\t);\r\n\t}\r\n}\r\nKagiSeries.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\tstroke: PropTypes.object,\r\n\tfill: PropTypes.object,\r\n\tstrokeWidth: PropTypes.number.isRequired,\r\n};\r\n\r\nKagiSeries.defaultProps = {\r\n\tclassName: \"react-stockcharts-kagi\",\r\n\tstrokeWidth: 2,\r\n\tstroke: {\r\n\t\tyang: \"#6BA583\",\r\n\t\tyin: \"#E60000\"\r\n\t},\r\n\tfill: {\r\n\t\tyang: \"none\",\r\n\t\tyin: \"none\"\r\n\t},\r\n\tcurrentValueStroke: \"#000000\",\r\n};\r\n\r\nfunction drawOnCanvas(ctx, props, moreProps, xAccessor) {\r\n\tconst { stroke, strokeWidth, currentValueStroke } = props;\r\n\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\tconst paths = helper(plotData, xAccessor);\r\n\r\n\tlet begin = true;\r\n\r\n\tpaths.forEach((each) => {\r\n\t\tctx.strokeStyle = stroke[each.type];\r\n\t\tctx.lineWidth = strokeWidth;\r\n\r\n\t\tctx.beginPath();\r\n\t\tlet prevX;\r\n\t\teach.plot.forEach(d => {\r\n\t\t\tconst [x, y] = [xScale(d[0]), yScale(d[1])];\r\n\t\t\tif (begin) {\r\n\t\t\t\tctx.moveTo(x, y);\r\n\t\t\t\tbegin = false;\r\n\t\t\t} else {\r\n\t\t\t\tif (isDefined(prevX)) {\r\n\t\t\t\t\tctx.lineTo(prevX, y);\r\n\t\t\t\t}\r\n\t\t\t\tctx.lineTo(x, y);\r\n\t\t\t}\r\n\t\t\tprevX = x;\r\n\t\t\t// console.log(d);\r\n\r\n\t\t});\r\n\t\tctx.stroke();\r\n\t});\r\n\tconst lastPlot = paths[paths.length - 1].plot;\r\n\tconst last = lastPlot[lastPlot.length - 1];\r\n\tctx.beginPath();\r\n\t// ctx.strokeStyle = \"black\";\r\n\tctx.lineWidth = 1;\r\n\r\n\tconst [x, y1, y2] = [xScale(last[0]), yScale(last[2]), yScale(last[3])];\r\n\t// console.log(last, x, y);\r\n\tctx.moveTo(x, y1);\r\n\tctx.lineTo(x + 10, y1);\r\n\tctx.stroke();\r\n\r\n\tctx.beginPath();\r\n\tctx.strokeStyle = currentValueStroke;\r\n\tctx.moveTo(x - 10, y2);\r\n\tctx.lineTo(x, y2);\r\n\tctx.stroke();\r\n}\r\n\r\nfunction helper(plotData, xAccessor) {\r\n\tconst kagiLine = [];\r\n\tlet kagi = {};\r\n\tlet d = plotData[0];\r\n\tlet idx = xAccessor(d);\r\n\r\n\tfor (let i = 0; i < plotData.length; i++) {\r\n\t\td = plotData[i];\r\n\r\n\t\tif (isNotDefined(d.close)) continue;\r\n\t\tif (isNotDefined(kagi.type)) kagi.type = d.startAs;\r\n\t\tif (isNotDefined(kagi.plot)) kagi.plot = [];\r\n\r\n\t\tidx = xAccessor(d);\r\n\t\tkagi.plot.push([idx, d.open]);\r\n\r\n\t\tif (isDefined(d.changeTo)) {\r\n\t\t\tkagi.plot.push([idx, d.changePoint]);\r\n\t\t\tkagi.added = true;\r\n\t\t\tkagiLine.push(kagi);\r\n\r\n\t\t\tkagi = {\r\n\t\t\t\ttype: d.changeTo,\r\n\t\t\t\tplot: [],\r\n\t\t\t\tadded: false,\r\n\t\t\t};\r\n\t\t\tkagi.plot.push([idx, d.changePoint]);\r\n\t\t}\r\n\t}\r\n\r\n\tif (!kagi.added) {\r\n\t\tkagi.plot.push([idx, d.close, d.current, d.reverseAt]);\r\n\t\tkagiLine.push(kagi);\r\n\t}\r\n\r\n\t// console.log(d.reverseAt);\r\n\r\n\treturn kagiLine;\r\n}\r\n\r\nexport default KagiSeries;\r\n"],"mappings":"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"}