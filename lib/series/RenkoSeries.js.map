{"version":3,"file":"RenkoSeries.js","names":["RenkoSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","xScale","yScale","chartConfig","plotData","yAccessor","candles","getRenko","clip","getAxisCanvas","map","each","idx","className","fill","x","y","width","height","Component","propTypes","classNames","PropTypes","shape","up","string","down","stroke","partial","func","isRequired","bool","defaultProps","d","open","high","low","close","renko","forEach","beginPath","strokeStyle","fillStyle","rect","closePath","length","candleWidth","filter","isDefined","ohlc","Math","max","abs","svgfill","fullyFormed"],"sources":["../../../src/lib/series/RenkoSeries.js"],"sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport { isDefined } from \"../utils\";\r\n\r\nclass RenkoSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\t\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\t\tconst { yAccessor } = this.props;\r\n\r\n\t\tconst candles = getRenko(this.props, plotData, xScale, xAccessor, yScale, yAccessor);\r\n\r\n\t\tdrawOnCanvas(ctx, candles);\r\n\t}\r\n\trender() {\r\n\t\tconst { clip } = this.props;\r\n\r\n\t\treturn <GenericChartComponent\r\n\t\t\tclip={clip}\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\t\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\t\tconst { yAccessor } = this.props;\r\n\r\n\t\tconst candles = getRenko(this.props, plotData, xScale, xAccessor, yScale, yAccessor)\r\n\t\t\t.map((each, idx) => (<rect key={idx} className={each.className}\r\n\t\t\t\tfill={each.fill}\r\n\t\t\t\tx={each.x}\r\n\t\t\t\ty={each.y}\r\n\t\t\t\twidth={each.width}\r\n\t\t\t\theight={each.height} />));\r\n\r\n\t\treturn (\r\n\t\t\t<g>\r\n\t\t\t\t<g className=\"candle\">\r\n\t\t\t\t\t{candles}\r\n\t\t\t\t</g>\r\n\t\t\t</g>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nRenkoSeries.propTypes = {\r\n\tclassNames: PropTypes.shape({\r\n\t\tup: PropTypes.string,\r\n\t\tdown: PropTypes.string\r\n\t}),\r\n\tstroke: PropTypes.shape({\r\n\t\tup: PropTypes.string,\r\n\t\tdown: PropTypes.string\r\n\t}),\r\n\tfill: PropTypes.shape({\r\n\t\tup: PropTypes.string,\r\n\t\tdown: PropTypes.string,\r\n\t\tpartial: PropTypes.string\r\n\t}),\r\n\tyAccessor: PropTypes.func.isRequired,\r\n\tclip: PropTypes.bool.isRequired,\r\n};\r\n\r\nRenkoSeries.defaultProps = {\r\n\tclassNames: {\r\n\t\tup: \"up\",\r\n\t\tdown: \"down\"\r\n\t},\r\n\tstroke: {\r\n\t\tup: \"none\",\r\n\t\tdown: \"none\"\r\n\t},\r\n\tfill: {\r\n\t\tup: \"#6BA583\",\r\n\t\tdown: \"#E60000\",\r\n\t\tpartial: \"#4682B4\",\r\n\t},\r\n\tyAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\r\n\tclip: true,\r\n};\r\n\r\nfunction drawOnCanvas(ctx, renko) {\r\n\trenko.forEach(d => {\r\n\t\tctx.beginPath();\r\n\r\n\t\tctx.strokeStyle = d.stroke;\r\n\t\tctx.fillStyle = d.fill;\r\n\r\n\t\tctx.rect(d.x, d.y, d.width, d.height);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t});\r\n}\r\n\r\nfunction getRenko(props, plotData, xScale, xAccessor, yScale, yAccessor) {\r\n\tconst { classNames, fill } = props;\r\n\tconst width = xScale(xAccessor(plotData[plotData.length - 1]))\r\n\t\t- xScale(xAccessor(plotData[0]));\r\n\r\n\tconst candleWidth = (width / (plotData.length - 1));\r\n\tconst candles = plotData\r\n\t\t.filter(d => isDefined(yAccessor(d).close))\r\n\t\t.map(d => {\r\n\t\t\tconst ohlc = yAccessor(d);\r\n\t\t\tconst x = xScale(xAccessor(d)) - 0.5 * candleWidth,\r\n\t\t\t\ty = yScale(Math.max(ohlc.open, ohlc.close)),\r\n\t\t\t\theight = Math.abs(yScale(ohlc.open) - yScale(ohlc.close)),\r\n\t\t\t\tclassName = (ohlc.open <= ohlc.close) ? classNames.up : classNames.down;\r\n\r\n\t\t\tconst svgfill = d.fullyFormed\r\n\t\t\t\t? (ohlc.open <= ohlc.close ? fill.up : fill.down)\r\n\t\t\t\t: fill.partial;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tclassName: className,\r\n\t\t\t\tfill: svgfill,\r\n\t\t\t\tx: x,\r\n\t\t\t\ty: y,\r\n\t\t\t\theight: height,\r\n\t\t\t\twidth: candleWidth,\r\n\t\t\t};\r\n\t\t});\r\n\treturn candles;\r\n}\r\n\r\nexport default RenkoSeries;\r\n"],"mappings":"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"}